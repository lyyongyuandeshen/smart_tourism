var P=Object.defineProperty;var U=(a,e,t)=>e in a?P(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var O=(a,e,t)=>(U(a,typeof e!="symbol"?e+"":e,t),t);import{ba as F,O as d,m as k,aQ as V,ak as L,bb as Q,d as x,r as y,a2 as Y,$ as G,n as z,o as c,c as v,a as l,b as f,R as m,N as H,a6 as h,ab as w,al as J,ah as B,a5 as E,ac as A,a3 as M,aW as W,a4 as X,X as q,aa as Z,Q as ee,a_ as te,a1 as se,bc as ae}from"./index-5805bd08.js";import{s as oe}from"./suno-afa09782.js";class R{constructor(){O(this,"localKey","luma-store")}save(e){if(!e.id)throw"id must";let t=this.getObjs(),n=t.findIndex(i=>i.id==e.id);return n>-1?t[n]=e:t.push(e),F.set(this.localKey,t),this}findIndex(e){return this.getObjs().findIndex(t=>t.id==e)}getObjs(){const e=F.get(this.localKey);return e||[]}}function re(){let a={};if(d.myData.vtoken){const t={"x-vtoken":d.myData.vtoken,"x-ctoken":d.myData.ctoken};a={...a,...t}}if(!L.myData.LUMA_KEY){const t=Q();if(t.token){const n={"x-ptoken":t.token};return a={...a,...n},a}return a}const e={Authorization:"Bearer "+L.myData.LUMA_KEY};return a={...a,...e},a}const ne=a=>a.indexOf("http")==0?a:`/api/luma${a}`,K=(a,e,t)=>{k("sunoFetch",a);let n={"Content-Type":"application/json",Authorization:"Bearer "+V()};return t&&t.headers&&(n=t.headers),n={...n,...re()},new Promise((i,u)=>{let p={method:"GET"};p.headers=n,t!=null&&t.upFile?(p.method="POST",p.body=e):e&&(p.body=JSON.stringify(e),p.method="POST"),fetch(ne(a),p).then(async s=>{var _;if(!s.ok){let o="发生错误: "+s.status;try{let r=await s.json();o="("+s.status+")发生错误: "+(((_=r==null?void 0:r.error)==null?void 0:_.message)??"")}catch{}throw d.myData.ms&&d.myData.ms.error(o),new Error(o)}s.json().then(o=>i(o)).catch(o=>{d.myData.ms&&d.myData.ms.error("发生错误"+o),u(o)})}).catch(s=>{s.name==="TypeError"&&s.message==="Failed to fetch"?d.myData.ms&&d.myData.ms.error("跨域|CORS error"):d.myData.ms&&d.myData.ms.error("发生错误:"+s),k("e",s.stat),u(s)})})},b=async a=>{var t;if(a=="")return"";const e=new R;for(let n=0;n<120;n++){let i=await K("/generations/"+a);if(i.id&&(i.last_feed=new Date().getTime(),e.save(i),d.setMyData({act:"FeedLumaTask"}),i.state=="completed"&&i.video&&((t=i.video)!=null&&t.download_url)))break;await oe(5*1e3)}},le={class:"p-2"},ie={class:"pt-1"},de={class:"flex justify-between items-end"},ue=["src"],ce={key:1,class:"text-center"},ve={class:"pb-1 text-right"},pe=x({__name:"voInput",setup(a){const e=y({aspect_ratio:"16:9",expand_prompt:!0,image_url:"",user_prompt:""}),t=y({isDo:!1}),n=Y(),i=y();G(()=>{d.setMyData({ms:n})});const u=z(()=>e.value.user_prompt!=""&&!t.value.isDo),p=async()=>{if(k("generate",e.value),t.value.isDo=!0,!u){n.error(M("video.plsInput"));return}try{const o=await K("/generations/",e.value);k("d",o),o.id?b(o.id):b(o[0].id),n.success(M("video.submitSuccess"))}catch{}t.value.isDo=!1};function s(o){W(o.target.files[0]).then(r=>{e.value.image_url=r,i.value=""}).catch(r=>n.error(r))}const _=()=>{e.value.user_prompt="",e.value.image_url=""};return(o,r)=>(c(),v("div",le,[l("div",null,[f(m(H),{value:e.value.user_prompt,"onUpdate:value":r[0]||(r[0]=g=>e.value.user_prompt=g),placeholder:o.$t("video.descpls"),type:"textarea",size:"small",autosize:{minRows:3,maxRows:12}},null,8,["value","placeholder"])]),l("div",ie,[l("div",de,[l("div",null,[l("input",{type:"file",onChange:s,ref_key:"fsRef",ref:i,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),l("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer upload-video",onClick:r[1]||(r[1]=g=>i.value.click())},[e.value.image_url?(c(),v("img",{key:0,src:e.value.image_url},null,8,ue)):(c(),v("div",ce,h(o.$t("video.selectimg")),1))])]),l("div",ve,[f(m(J),{type:"info",size:"small",round:""},{default:w(()=>[l("span",{class:"cursor-pointer",onClick:r[2]||(r[2]=g=>_())},h(o.$t("video.clear")),1)]),_:1})])]),l("div",null,[l("div",null,[f(m(A),{loading:t.value.isDo,style:{"border-radius":"10px"},class:"genner-button",bordered:!1,type:"success",disabled:!u.value,onClick:r[3]||(r[3]=g=>p())},{default:w(()=>[f(m(B),{icon:"ri:video-add-line"}),E(" "+h(o.$t("video.generate")),1)]),_:1},8,["loading","disabled"])])])])]))}}),me={key:0,class:"p-4"},fe={class:"grid grid-cols-1 gap-5 md:grid-cols-2 lg:grid-cols-3"},_e=["onMousemove"],he={class:"relative flex items-center justify-center bg-white bg-opacity-10 rounded-[16px] overflow-hidden aspect-[16/8.85]"},ge=["src","controls"],ye={key:1,class:"text-center"},we={key:1,class:"pt-2"},ke={class:"flex justify-between items-center"},be={class:"line-clamp-1"},xe={class:"max-w-[300px]"},$e=["href"],De={key:1,class:"w-full h-full flex justify-center items-center"},Se=x({__name:"voList",setup(a){const e=y({pIndex:-1}),t=y([]),n=new R,i=()=>{let u=n.getObjs();t.value=u.reverse()};return z(()=>new Date().getTime()),X(()=>d.myData.act,u=>{u=="FeedLumaTask"&&i()}),i(),(u,p)=>t.value.length>0?(c(),v("div",me,[l("div",fe,[(c(!0),v(q,null,Z(t.value,(s,_)=>{var o,r,g,$,D,S,T,I,j,C;return c(),v("div",{key:_,class:"relative",onMousemove:N=>e.value.pIndex=_,onMouseout:p[0]||(p[0]=N=>e.value.pIndex=-1)},[l("div",he,[(o=s.video)!=null&&o.url||(r=s.video)!=null&&r.download_url?(c(),v("video",{key:0,src:(g=s.video)!=null&&g.download_url?($=s.video)==null?void 0:$.download_url:(D=s.video)==null?void 0:D.url,loop:"",playsinline:"",controls:e.value.pIndex==_,class:"w-full h-full object-cover"},null,8,ge)):(c(),v("div",ye,[!s.last_feed||new Date().getTime()-s.last_feed>20*1e3?(c(),ee(m(A),{key:0,size:"small",type:"primary",onClick:N=>m(b)(s.id)},{default:w(()=>[E(h(u.$t("video.repeat")),1)]),_:1},8,["onClick"])):(c(),v("div",we,h(u.$t("video.process"))+h(new Date(s.last_feed).toLocaleString()),1))]))]),l("div",ke,[l("div",null,[f(m(te),{trigger:"hover"},{trigger:w(()=>[l("div",be,h(s.prompt),1)]),default:w(()=>[l("div",xe,h(s.prompt),1)]),_:2},1024)]),l("div",null,[(S=s.video)!=null&&S.url||(T=s.video)!=null&&T.download_url?(c(),v("a",{key:0,href:(I=s.video)!=null&&I.download_url?(j=s.video)==null?void 0:j.download_url:(C=s.video)==null?void 0:C.url,download:"",target:"_blank"},[f(m(B),{icon:"mdi:download",class:"cursor-pointer"})],8,$e)):se("",!0)])])],40,_e)}),128))])])):(c(),v("div",De,[f(m(ae),{description:u.$t("video.nodata")},null,8,["description"])]))}}),Te={class:"flex w-full h-full video-content"},Ie={class:"w-[300px] h-full overflow-y-auto vo-input"},je={class:"flex-1 h-full bg-[#fafbfc] pt-2 dark:bg-[#18181c] overflow-y-auto video-list"},Fe=x({__name:"video",setup(a){return(e,t)=>(c(),v("div",Te,[l("div",Ie,[f(pe)]),l("div",je,[f(Se)])]))}});export{Fe as default};
