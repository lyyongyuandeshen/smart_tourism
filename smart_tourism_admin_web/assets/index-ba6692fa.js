import{d as S,r as y,o as d,c as u,X as I,aa as E,a as e,a6 as g,a1 as F,a5 as C,b as o,R as l,ah as m,ab as M,ac as R,b6 as A,$ as B,bj as L,N as T,c3 as j,a2 as O,be as P,c0 as z,as as D}from"./index-fc2ca07d.js";import{A as G}from"./index-1efe5955.js";const U={key:0,class:"flex"},V={class:"flex-1"},Z={class:"bg-white py-[1.625rem] px-4 rounded-[0.5rem] word-break break-all font-medium text-sm text-[#1D2129]"},H={key:0},K={key:1},J={class:"bg-white border border-[#F53F3F] rounded-[0.5rem] py-2 px-[0.875rem] mt-[1.125rem]"},W={class:"flex justify-between items-center mb-[1.125rem]"},q={class:"flex items-center gap-2"},Q={class:"rounded-[0.25rem] w-6 h-6 bg-[#F53F3F] flex items-center justify-center text-white"},Y={class:"flex items-center gap-2"},ee={class:"mt-[1.125rem]"},te={class:"flex-1"},se={class:"text-[0.75rem] text-[#86909C]"},oe={class:"text-area text-area_warning mt-[1.125rem]"},ne={class:"flex-1"},ae={class:"mt-2 text-area !py-4"},ie={class:"flex-1 flex items-center gap-3"},le={key:1,class:"flex items-start justify-end"},re={class:"flex-1 flex justify-end"},ce={class:"py-3 px-4 bg-[#E8F3FF] rounded-[0.5rem] word-break break-all font-medium text-sm text-[#303133]"},de=S({__name:"SafetyChatArea",props:{messages:{},warning:{},routes:{},accidentReport:{}},emits:["sos-click"],setup(k,{expose:x,emit:p}){const i=p,_=()=>{i("sos-click")},s=y();return x({chatAreaRef:s}),(n,t)=>(d(),u("div",{class:"flex-1 overflow-y-auto pr-5",ref_key:"chatAreaRef",ref:s,style:{"margin-bottom":"90px"}},[(d(!0),u(I,null,E(n.messages,a=>(d(),u("div",{key:a.id,class:"mb-4"},[a.type==="warning"||a.type==="system"?(d(),u("div",U,[t[8]||(t[8]=e("div",{class:"w-10 h-10 rounded-full bg-blue-300 mr-2"},null,-1)),e("div",V,[e("div",Z,[a.type==="system"?(d(),u("div",H,g(a.content),1)):F("",!0),a.type==="warning"?(d(),u("div",K,[t[6]||(t[6]=C(" 根据您发的地理位置 ")),e("div",J,[e("div",W,[e("div",q,[e("div",Q,[o(l(m),{icon:"ri:error-warning-fill",class:"w-4 h-4"})]),C(" "+g(a.content.title),1)]),e("div",Y,[t[0]||(t[0]=e("div",{class:"bg-[#FFECE8] bounded-[0.125rem] text-[#F53F3F] px-2 py-[1px]"}," 高风险 ",-1)),o(l(m),{icon:"ri:arrow-right-wide-fill",class:"w-5 h-5 text-[#4E5969]"})])]),e("div",null,g(a.content.message),1)]),e("div",ee,[t[1]||(t[1]=C(" 为您规划了以下疏散线路 ")),t[2]||(t[2]=e("div",{class:"my-[1.125rem]"}," 根据用户上传的文件及地图显示的地理位置，推荐以下疏散路线。 ",-1)),(d(!0),u(I,null,E(n.routes,f=>(d(),u("div",{key:f.id,class:"text-area text-area_warning mt-2"},[e("div",te,[e("div",se,g(f.name),1),e("div",null,"起点："+g(f.start)+"→终点："+g(f.end),1)]),o(l(m),{icon:"ri:arrow-right-wide-fill",class:"w-4 h-4 text-[#4E5969]"})]))),128))]),t[7]||(t[7]=e("div",{class:"mt-[1.125rem]"}," 根据用户描述及地图显示的地理位置，请确认报警信息 ",-1)),e("div",oe,[e("div",ne,[t[3]||(t[3]=e("div",{class:"text-[0.75rem] text-[#86909C]"},"一键报警",-1)),e("div",null,"地址："+g(n.accidentReport.address),1),e("div",null,"事故类型："+g(n.accidentReport.type),1)]),o(l(R),{color:"#F53F3F",onClick:_,class:"!leading-[1.375] !py-1 !px-4 !rounded-[0.5rem]"},{default:M(()=>t[4]||(t[4]=[C(" SOS  一键报警 ")])),_:1})]),e("div",ae,[e("div",ie,[o(l(m),{icon:"ri:file-text-line",class:"w-3 h-3 text-[#4E5969]"}),t[5]||(t[5]=C(" 知识引用6个文档 "))]),o(l(m),{icon:"ri:arrow-right-wide-fill",class:"w-4 h-4 text-[#4E5969]"})])])):F("",!0)])])])):a.type==="user"?(d(),u("div",le,[e("div",re,[e("div",ce,g(a.content),1)]),t[9]||(t[9]=e("div",{class:"w-10 h-10 rounded-full bg-gray-300 ml-2"},null,-1))])):F("",!0)]))),128))],512))}});const ue=A(de,[["__scopeId","data-v-cee83ae1"]]),pe={class:"map-container-wrapper"},_e=S({__name:"MapContainer",props:{autoLocate:{type:Boolean},initialCenter:{},initialZoom:{}},emits:["map-ready","poi-click"],setup(k,{emit:x}){const p=k,i=x,_=y(null);let s=null,n=null;const t=async()=>{if(_.value)try{window._AMapSecurityConfig={securityJsCode:"a3ae5b960f3ed908393672ac36fc7bf1"};const r=await G.load({key:"d7dd3eae862ecc57ed11d6f603358601",version:"2.0",plugins:["AMap.ToolBar","AMap.Scale","AMap.Geolocation","AMap.Geocoder"],AMapUI:{version:"1.1",plugins:[]}});s=new r.Map(_.value,{zoom:p.initialZoom||11,center:p.initialCenter||[116.397428,39.90923],viewMode:"3D",pitch:30}),s.addControl(new r.ToolBar),s.addControl(new r.Scale),n=new r.Geocoder({city:"010",radius:1e3}),i("map-ready",s),a(),p.autoLocate&&f(r)}catch(r){console.error("地图初始化失败:",r)}},a=()=>{!s||!n||s.on("click",r=>{const c=r.lnglat;n.getAddress(c,(b,v)=>{if(b==="complete"&&v.regeocode){const X={lnglat:c,longitude:c.getLng(),latitude:c.getLat(),address:v.regeocode.formattedAddress,addressComponent:v.regeocode.addressComponent,pois:v.regeocode.pois||[],businessAreas:v.regeocode.businessAreas||[]};console.log("点击位置信息:",X),i("poi-click",X)}else console.error("根据经纬度查询地址失败:",v)})})},f=r=>{const c=new r.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new r.Pixel(10,20),zoomToAccuracy:!0});s.addControl(c),c.getCurrentPosition(),c.on("complete",b=>{console.log("定位成功:",b)}),c.on("error",b=>{console.error("定位失败:",b)})};return B(()=>{t()}),L(()=>{s&&(s.destroy(),s=null),n=null}),(r,c)=>(d(),u("div",pe,[e("div",{ref_key:"mapContainer",ref:_,class:"map-container"},null,512)]))}});const me=A(_e,[["__scopeId","data-v-a20c3dff"]]),fe={class:"safety-map-container"},ve=S({__name:"SafetyMap",emits:["poi-click"],setup(k,{emit:x}){const p=x,i={autoLocate:!0,initialZoom:13},_=s=>{const n=s.name||s.address||"未知地点";p("poi-click",n)};return(s,n)=>(d(),u("div",fe,[o(me,{"auto-locate":i.autoLocate,"initial-zoom":i.initialZoom,onPoiClick:_},null,8,["auto-locate","initial-zoom"])]))}});const ye=A(ve,[["__scopeId","data-v-d00b0889"]]),xe={class:"input-area"},he={class:"flex items-center justify-between"},ge={class:"flex items-center gap-4"},we=S({__name:"SafetyInputArea",emits:["send-message","sos-alert"],setup(k,{emit:x}){const p=x,i=y(""),_=()=>{i.value.trim()&&(p("send-message",i.value),i.value="")},s=()=>{p("sos-alert")},n=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),_())};return(t,a)=>(d(),u("div",xe,[o(l(T),{value:i.value,"onUpdate:value":a[0]||(a[0]=f=>i.value=f),placeholder:"我要求助报警",class:"w-full",type:"textarea",autosize:{minRows:1,maxRows:3},onKeydown:n},null,8,["value"]),o(l(j),{class:"!my-4"}),e("div",he,[e("div",ge,[e("button",null,[o(l(m),{icon:"ri:add-circle-line",class:"text-[1.25rem]"})]),e("button",null,[o(l(m),{icon:"ri:mic-line",class:"text-[1.25rem]"})]),e("button",null,[o(l(m),{icon:"ri:customer-service-2-fill",class:"text-[1.25rem]"})]),e("button",{onClick:s,class:"sos"},"SOS")]),o(l(R),{circle:"",type:"info",onClick:_,color:"#235FC8",class:"!w-8 !h-8"},{default:M(()=>[o(l(m),{icon:"ri:arrow-up-long-line"})]),_:1})])]))}});const be=A(we,[["__scopeId","data-v-2fb8c1ff"]]),Ce={class:"h-full flex relative overflow-hidden"},ke={class:"flex-1 overflow-hidden flex py-8 pr-12"},Xe={class:"collapse-area"},Se={class:"flex-1 overflow-hidden flex flex-col"},Ae={class:"flex-1 overflow-hidden h-full"},Me={class:"absolute bottom-8 left-[calc(30px+1.5rem)] right-[calc(40%+3rem)]"},$e={class:"overflow-hidden w-2/5 rounded-[0.5rem] bg-white shadow-[0px_0.125rem_1rem_0.125rem_rgba(77,87,121,0.1)]"},Fe={class:"py-3 px-6 flex items-center justify-between text-[1rem] text-[#1D2129]"},Re={class:"h-full"},Ie=S({__name:"index",setup(k){const x=O(),p=P(),i=y({title:"预警信息",message:"该景区目前人流量已达XXXXX人，踩踏事故发生的可能性高"}),_=y([{id:1,name:"疏散路线1",start:"XXXXXXX",end:"XXXXX"},{id:2,name:"疏散路线2",start:"XXXXXXX",end:"XXXXX"}]),s=y({address:"XXXXXX",type:"踩踏事故"}),n=y([{id:1,type:"user",content:"我在景区遇到了紧急情况，需要帮助！"},{id:2,type:"warning",content:i.value}]),t=()=>{x.success("SOS警报已发送，救援人员将尽快到达")},a=h=>{const w=n.value.length>0?Math.max(...n.value.map($=>$.id)):0;n.value.push({id:w+1,type:"user",content:h}),setTimeout(()=>{n.value.push({id:w+2,type:"warning",content:i.value}),N()},500)},f=h=>{a(`我在${h}遇到紧急情况，需要帮助！`)},r=h=>{a(h)},c=y(!1),b=()=>{c.value=!c.value,p.setSiderCollapsed(c.value)},v=y(),X=y(),N=()=>{D(()=>{var h,w;if(v.value){const $=((w=(h=X.value)==null?void 0:h.chatAreaRef)==null?void 0:w.offsetHeight)||100;v.value.scrollTo({left:0,top:$,behavior:"smooth"})}})};return(h,w)=>(d(),u("div",Ce,[e("div",ke,[e("div",Xe,[o(l(R),{tertiary:"",size:"small",onClick:b,class:"collapse-area-button"},{icon:M(()=>[o(l(m),{icon:c.value?"ri:menu-unfold-line":"ri:menu-fold-line"},null,8,["icon"])]),_:1})]),e("div",Se,[e("div",Ae,[o(l(z),{ref_key:"scrollbarRef",ref:v,class:"h-full",trigger:"hover"},{default:M(()=>[o(ue,{messages:n.value,warning:i.value,routes:_.value,"accident-report":s.value,onSosClick:t,ref_key:"chatAreaRef",ref:X},null,8,["messages","warning","routes","accident-report"])]),_:1},512)]),e("div",Me,[o(be,{onSendMessage:r,onSosAlert:t})])]),e("div",$e,[e("div",Fe,[w[0]||(w[0]=C(" 地图规划 ")),o(l(m),{icon:"ri:expand-diagonal-line",class:"cursor-pointer"})]),e("div",Re,[o(ye,{onPoiClick:f})])])])]))}});const Be=A(Ie,[["__scopeId","data-v-09390078"]]);export{Be as default};
