import{d as S,r as x,o as d,c as u,X as I,aa as E,a as e,a6 as w,a1 as F,a5 as k,b as o,R as i,ah as m,ab as M,ac as R,b7 as A,$ as B,bj as L,N as T,c3 as j,a2 as O,be as P,c0 as z,as as D}from"./index-5805bd08.js";import{A as G}from"./index-70bed514.js";const U={key:0,class:"flex"},V={class:"flex-1"},Z={class:"bg-white py-[1.625rem] px-4 rounded-[0.5rem] word-break break-all font-medium text-sm text-[#1D2129]"},H={key:0},K={key:1},J={class:"bg-white border border-[#F53F3F] rounded-[0.5rem] py-2 px-[0.875rem] mt-[1.125rem]"},W={class:"flex justify-between items-center mb-[1.125rem]"},q={class:"flex items-center gap-2"},Q={class:"rounded-[0.25rem] w-6 h-6 bg-[#F53F3F] flex items-center justify-center text-white"},Y={class:"flex items-center gap-2"},ee={class:"mt-[1.125rem]"},te={class:"flex-1"},se={class:"text-[0.75rem] text-[#86909C]"},oe={class:"text-area text-area_warning mt-[1.125rem]"},ne={class:"flex-1"},ae={class:"mt-2 text-area !py-4"},ie={class:"flex-1 flex items-center gap-3"},le={key:1,class:"flex items-start justify-end"},re={class:"flex-1 flex justify-end"},ce={class:"py-3 px-4 bg-[#E8F3FF] rounded-[0.5rem] word-break break-all font-medium text-sm text-[#303133]"},de=S({__name:"SafetyChatArea",props:{messages:{},warning:{},routes:{},accidentReport:{}},emits:["sos-click"],setup(y,{expose:h,emit:_}){const a=_,p=()=>{a("sos-click")},s=x();return h({chatAreaRef:s}),(l,t)=>(d(),u("div",{class:"flex-1 overflow-y-auto pr-5",ref_key:"chatAreaRef",ref:s,style:{"margin-bottom":"90px"}},[(d(!0),u(I,null,E(y.messages,n=>(d(),u("div",{key:n.id,class:"mb-4"},[n.type==="warning"||n.type==="system"?(d(),u("div",U,[t[8]||(t[8]=e("div",{class:"w-10 h-10 rounded-full bg-blue-300 mr-2"},null,-1)),e("div",V,[e("div",Z,[n.type==="system"?(d(),u("div",H,w(n.content),1)):F("",!0),n.type==="warning"?(d(),u("div",K,[t[6]||(t[6]=k(" 根据您发的地理位置 ",-1)),e("div",J,[e("div",W,[e("div",q,[e("div",Q,[o(i(m),{icon:"ri:error-warning-fill",class:"w-4 h-4"})]),k(" "+w(n.content.title),1)]),e("div",Y,[t[0]||(t[0]=e("div",{class:"bg-[#FFECE8] bounded-[0.125rem] text-[#F53F3F] px-2 py-[1px]"}," 高风险 ",-1)),o(i(m),{icon:"ri:arrow-right-wide-fill",class:"w-5 h-5 text-[#4E5969]"})])]),e("div",null,w(n.content.message),1)]),e("div",ee,[t[1]||(t[1]=k(" 为您规划了以下疏散线路 ",-1)),t[2]||(t[2]=e("div",{class:"my-[1.125rem]"}," 根据用户上传的文件及地图显示的地理位置，推荐以下疏散路线。 ",-1)),(d(!0),u(I,null,E(y.routes,f=>(d(),u("div",{key:f.id,class:"text-area text-area_warning mt-2"},[e("div",te,[e("div",se,w(f.name),1),e("div",null,"起点："+w(f.start)+"→终点："+w(f.end),1)]),o(i(m),{icon:"ri:arrow-right-wide-fill",class:"w-4 h-4 text-[#4E5969]"})]))),128))]),t[7]||(t[7]=e("div",{class:"mt-[1.125rem]"}," 根据用户描述及地图显示的地理位置，请确认报警信息 ",-1)),e("div",oe,[e("div",ne,[t[3]||(t[3]=e("div",{class:"text-[0.75rem] text-[#86909C]"},"一键报警",-1)),e("div",null,"地址："+w(y.accidentReport.address),1),e("div",null,"事故类型："+w(y.accidentReport.type),1)]),o(i(R),{color:"#F53F3F",onClick:p,class:"!leading-[1.375] !py-1 !px-4 !rounded-[0.5rem]"},{default:M(()=>[...t[4]||(t[4]=[k(" SOS  一键报警 ",-1)])]),_:1})]),e("div",ae,[e("div",ie,[o(i(m),{icon:"ri:file-text-line",class:"w-3 h-3 text-[#4E5969]"}),t[5]||(t[5]=k(" 知识引用6个文档 ",-1))]),o(i(m),{icon:"ri:arrow-right-wide-fill",class:"w-4 h-4 text-[#4E5969]"})])])):F("",!0)])])])):n.type==="user"?(d(),u("div",le,[e("div",re,[e("div",ce,w(n.content),1)]),t[9]||(t[9]=e("div",{class:"w-10 h-10 rounded-full bg-gray-300 ml-2"},null,-1))])):F("",!0)]))),128))],512))}});const ue=A(de,[["__scopeId","data-v-cee83ae1"]]),_e={class:"map-container-wrapper"},pe=S({__name:"MapContainer",props:{autoLocate:{type:Boolean},initialCenter:{},initialZoom:{}},emits:["map-ready","poi-click"],setup(y,{emit:h}){const _=y,a=h,p=x(null);let s=null,l=null;const t=async()=>{if(p.value)try{window._AMapSecurityConfig={securityJsCode:"a3ae5b960f3ed908393672ac36fc7bf1"};const r=await G.load({key:"d7dd3eae862ecc57ed11d6f603358601",version:"2.0",plugins:["AMap.ToolBar","AMap.Scale","AMap.Geolocation","AMap.Geocoder"],AMapUI:{version:"1.1",plugins:[]}});s=new r.Map(p.value,{zoom:_.initialZoom||11,center:_.initialCenter||[116.397428,39.90923],viewMode:"3D",pitch:30}),s.addControl(new r.ToolBar),s.addControl(new r.Scale),l=new r.Geocoder({city:"010",radius:1e3}),a("map-ready",s),n(),_.autoLocate&&f(r)}catch(r){console.error("地图初始化失败:",r)}},n=()=>{!s||!l||s.on("click",r=>{const c=r.lnglat;l.getAddress(c,(C,v)=>{if(C==="complete"&&v.regeocode){const X={lnglat:c,longitude:c.getLng(),latitude:c.getLat(),address:v.regeocode.formattedAddress,addressComponent:v.regeocode.addressComponent,pois:v.regeocode.pois||[],businessAreas:v.regeocode.businessAreas||[]};console.log("点击位置信息:",X),a("poi-click",X)}else console.error("根据经纬度查询地址失败:",v)})})},f=r=>{const c=new r.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new r.Pixel(10,20),zoomToAccuracy:!0});s.addControl(c),c.getCurrentPosition(),c.on("complete",C=>{console.log("定位成功:",C)}),c.on("error",C=>{console.error("定位失败:",C)})};return B(()=>{t()}),L(()=>{s&&(s.destroy(),s=null),l=null}),(r,c)=>(d(),u("div",_e,[e("div",{ref_key:"mapContainer",ref:p,class:"map-container"},null,512)]))}});const me=A(pe,[["__scopeId","data-v-a20c3dff"]]),fe={class:"safety-map-container"},ve=S({__name:"SafetyMap",emits:["poi-click"],setup(y,{emit:h}){const _=h,a={autoLocate:!0,initialZoom:13},p=s=>{const l=s.name||s.address||"未知地点";_("poi-click",l)};return(s,l)=>(d(),u("div",fe,[o(me,{"auto-locate":a.autoLocate,"initial-zoom":a.initialZoom,onPoiClick:p},null,8,["auto-locate","initial-zoom"])]))}});const xe=A(ve,[["__scopeId","data-v-d00b0889"]]),ye={class:"input-area"},he={class:"flex items-center justify-between"},ge={class:"flex items-center gap-4"},we=S({__name:"SafetyInputArea",emits:["send-message","sos-alert"],setup(y,{emit:h}){const _=h,a=x(""),p=()=>{a.value.trim()&&(_("send-message",a.value),a.value="")},s=()=>{_("sos-alert")},l=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),p())};return(t,n)=>(d(),u("div",ye,[o(i(T),{value:a.value,"onUpdate:value":n[0]||(n[0]=f=>a.value=f),placeholder:"我要求助报警",class:"w-full",type:"textarea",autosize:{minRows:1,maxRows:3},onKeydown:l},null,8,["value"]),o(i(j),{class:"!my-4"}),e("div",he,[e("div",ge,[e("button",null,[o(i(m),{icon:"ri:add-circle-line",class:"text-[1.25rem]"})]),e("button",null,[o(i(m),{icon:"ri:mic-line",class:"text-[1.25rem]"})]),e("button",null,[o(i(m),{icon:"ri:customer-service-2-fill",class:"text-[1.25rem]"})]),e("button",{onClick:s,class:"sos"},"SOS")]),o(i(R),{circle:"",type:"info",onClick:p,color:"#235FC8",class:"!w-8 !h-8"},{default:M(()=>[o(i(m),{icon:"ri:arrow-up-long-line"})]),_:1})])]))}});const be=A(we,[["__scopeId","data-v-2fb8c1ff"]]),Ce={class:"h-full flex relative overflow-hidden"},ke={class:"flex-1 overflow-hidden flex py-8 pr-12"},Xe={class:"collapse-area"},Se={class:"flex-1 overflow-hidden flex flex-col"},Ae={class:"flex-1 overflow-hidden h-full"},Me={class:"absolute bottom-8 left-[calc(30px+1.5rem)] right-[calc(40%+3rem)]"},$e={class:"overflow-hidden w-2/5 rounded-[0.5rem] bg-white shadow-[0px_0.125rem_1rem_0.125rem_rgba(77,87,121,0.1)]"},Fe={class:"py-3 px-6 flex items-center justify-between text-[1rem] text-[#1D2129]"},Re={class:"h-full"},Ie=S({__name:"index",setup(y){const h=O(),_=P(),a=x({title:"预警信息",message:"该景区目前人流量已达XXXXX人，踩踏事故发生的可能性高"}),p=x([{id:1,name:"疏散路线1",start:"XXXXXXX",end:"XXXXX"},{id:2,name:"疏散路线2",start:"XXXXXXX",end:"XXXXX"}]),s=x({address:"XXXXXX",type:"踩踏事故"}),l=x([{id:1,type:"user",content:"我在景区遇到了紧急情况，需要帮助！"},{id:2,type:"warning",content:a.value}]),t=()=>{h.success("SOS警报已发送，救援人员将尽快到达")},n=g=>{const b=l.value.length>0?Math.max(...l.value.map($=>$.id)):0;l.value.push({id:b+1,type:"user",content:g}),setTimeout(()=>{l.value.push({id:b+2,type:"warning",content:a.value}),N()},500)},f=g=>{n(`我在${g}遇到紧急情况，需要帮助！`)},r=g=>{n(g)},c=x(!1),C=()=>{c.value=!c.value,_.setSiderCollapsed(c.value)},v=x(),X=x(),N=()=>{D(()=>{var g,b;if(v.value){const $=((b=(g=X.value)==null?void 0:g.chatAreaRef)==null?void 0:b.offsetHeight)||100;v.value.scrollTo({left:0,top:$,behavior:"smooth"})}})};return(g,b)=>(d(),u("div",Ce,[e("div",ke,[e("div",Xe,[o(i(R),{tertiary:"",size:"small",onClick:C,class:"collapse-area-button"},{icon:M(()=>[o(i(m),{icon:c.value?"ri:menu-unfold-line":"ri:menu-fold-line"},null,8,["icon"])]),_:1})]),e("div",Se,[e("div",Ae,[o(i(z),{ref_key:"scrollbarRef",ref:v,class:"h-full",trigger:"hover"},{default:M(()=>[o(ue,{messages:l.value,warning:a.value,routes:p.value,"accident-report":s.value,onSosClick:t,ref_key:"chatAreaRef",ref:X},null,8,["messages","warning","routes","accident-report"])]),_:1},512)]),e("div",Me,[o(be,{onSendMessage:r,onSosAlert:t})])]),e("div",$e,[e("div",Fe,[b[0]||(b[0]=k(" 地图规划 ",-1)),o(i(m),{icon:"ri:expand-diagonal-line",class:"cursor-pointer"})]),e("div",Re,[o(xe,{onPoiClick:f})])])])]))}});const Be=A(Ie,[["__scopeId","data-v-09390078"]]);export{Be as default};
