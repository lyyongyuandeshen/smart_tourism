import{b6 as _,d as K,r as g,a2 as O,bS as U,a4 as Q,$ as W,o as w,c as j,b as o,ab as c,R as r,w as b,bU as G,a as p,N as B,ah as N,ac as D,a5 as F,a6 as I,bW as J,Q as M,aS as X,a1 as H,ad as Y,b7 as Z}from"./index-5805bd08.js";import{N as ee}from"./DataTable-f0affd58.js";import{N as ae}from"./Pagination-78bedb34.js";import{N as te}from"./Form-9e4f5768.js";import{N as C}from"./FormItem-8b481c62.js";import{N as se}from"./Upload-bdfd020e.js";import"./Forward-dbe0c59b.js";function le(n){return _({url:"/v1/intangible-cultural-heritage/list",method:"get",params:n})}function ie(n){return _({url:"/v1/intangible-cultural-heritage/search",method:"get",params:n})}function re(n){const u=new FormData;return u.append("heritage_name",n.heritage_name),u.append("interactive_question_bank",n.interactive_question_bank),u.append("video_file",n.video_file),_({url:"/v1/intangible-cultural-heritage/create",method:"post",data:u,headers:{"Content-Type":"multipart/form-data"}})}function ne(n){return _({url:`/v1/intangible-cultural-heritage/${n}`,method:"get"})}function oe(n,u){const v=new FormData;return v.append("heritage_name",u),_({url:`/v1/intangible-cultural-heritage/${n}/name`,method:"put",data:v,headers:{"Content-Type":"multipart/form-data"}})}function ue(n,u=!0){const v=new FormData;return v.append("is_published",String(u)),_({url:`/v1/intangible-cultural-heritage/${n}/publish`,method:"put",data:v,headers:{"Content-Type":"multipart/form-data"}})}function de(n){return _({url:`/v1/intangible-cultural-heritage/${n}`,method:"delete"})}const ce={class:"heritage-container"},pe={class:"search-section"},ge={class:"search-wrapper"},fe={class:"add-wrapper"},me={class:"content-section"},ve={class:"content-wrapper"},he={class:"table-container"},be={class:"table-wrapper"},_e={class:"pagination-wrapper"},ye={class:"total-count"},ke={style:{"margin-left":"8px"}},we=K({__name:"index",setup(n){const u=g(null),v=g([{label:"厦门南音题库",value:"bank1"},{label:"厦门传统技艺题库",value:"bank2"},{label:"厦门民俗文化题库",value:"bank3"},{label:"厦门戏曲艺术题库",value:"bank4"}]),l=O(),x=g([]),d=g(!1),z=g([]),h=g(!1),S=g(null),s=U({heritageName:"",questionBank:null,files:[]}),L=g((()=>[{title:"非遗编号",key:"heritage_number",width:180},{title:"非遗名称",key:"heritage_name",width:200},{title:"互动题库",key:"interactive_question_bank",width:200},{title:"更新时间",key:"updated_at",width:200,render:a=>a.updated_at?new Date(a.updated_at).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-"):"-"},{title:"发布状态",key:"is_published",width:100,render:a=>b("span",{style:{color:a.is_published?"#52c41a":"#999"}},a.is_published?"已发布":"未发布")},{title:"操作",key:"actions",width:220,render:a=>b("div",{class:"action-cell",style:"display: inline-flex; align-items: center; gap: 8px;"},[b("span",{class:"action-link publish",style:{fontSize:"14px",color:"#1890ff",cursor:"pointer"},onClick:()=>R(a)},"发布"),b("span",{class:"action-divider",style:{color:"#d9d9d9"}},"|"),b("span",{class:"action-link edit",style:{fontSize:"14px",color:"#1890ff",cursor:"pointer"},onClick:()=>E(a)},"编辑"),b("span",{class:"action-divider",style:{color:"#d9d9d9"}},"|"),b("span",{class:"action-link delete",style:{fontSize:"14px",color:"#ff4d4f",cursor:"pointer"},onClick:()=>A(a)},"删除")])}])()),i=U({page:1,pageSize:10,itemCount:0,pageSizes:[10,20,30,50],showSizePicker:!0,onUpdatePage:a=>{i.page=a,f()},onUpdatePageSize:a=>{i.pageSize=a,i.page=1,f()}}),f=async()=>{try{d.value=!0;let a;if(u.value&&u.value.trim())a=await ie({heritage_name:u.value.trim(),page:i.page,page_size:i.pageSize});else{const e={page:i.page,page_size:i.pageSize};a=await le(e)}a.success?(x.value=a.data||[],i.itemCount=a.total||0):l.error(a.message||"获取数据失败")}catch(a){console.error("获取数据失败:",a),l.error(a.message||"获取数据失败")}finally{d.value=!1}},m=g(!1),y=g(null),P=()=>{m.value=!1,y.value=null,s.heritageName="",s.questionBank=null,s.files=[],h.value=!0},T=a=>{s.files=a.fileList},V=a=>{var q;const e=a.file.file;if(!e)return!0;const t=((q=e.name.split(".").pop())==null?void 0:q.toLowerCase())||"";return["mp4","avi","mov","wmv","flv","mkv","webm"].includes(t)?e.size/1024/1024<100?!0:(l.error("视频文件大小不能超过 100MB"),!1):(l.error("请上传视频文件（支持 mp4, avi, mov, wmv, flv, mkv, webm 格式）"),!1)},$=async()=>{var a;(a=S.value)==null||a.validate(async e=>{if(!e)try{if(d.value=!0,!m.value&&(!s.files||s.files.length===0)){l.error("请上传视频文件"),d.value=!1;return}if(m.value&&y.value){const t=await oe(y.value,s.heritageName);t.success?(l.success("更新成功"),f(),h.value=!1):l.error(t.message||"更新失败")}else{if(!s.files||s.files.length===0||!s.files[0].file){l.error("请上传视频文件"),d.value=!1;return}const t=s.files[0].file;if(!t){l.error("请上传视频文件"),d.value=!1;return}const k=await re({heritage_name:s.heritageName,interactive_question_bank:s.questionBank||"",video_file:t});k.success?(l.success("新增成功"),f(),h.value=!1):l.error(k.message||"新增失败")}}catch(t){console.error("操作失败:",t),l.error(t.message||"操作失败")}finally{d.value=!1}})},R=async a=>{try{d.value=!0;const e=await ue(a.heritage_number);e.success?(l.success("发布成功"),f()):l.error(e.message||"发布失败")}catch(e){console.error("发布失败:",e),l.error(e.message||"发布失败")}finally{d.value=!1}},E=async a=>{try{d.value=!0;const e=await ne(a.heritage_number);let t=null;if(e.success&&e.data)t=e.data;else if(e.heritage_number)t=e;else{l.error(e.message||"获取详情失败");return}t&&(m.value=!0,y.value=t.heritage_number,s.heritageName=t.heritage_name,s.questionBank=t.interactive_question_bank,s.files=[],h.value=!0)}catch(e){console.error("获取详情失败:",e),l.error(e.message||"获取详情失败")}finally{d.value=!1}},A=async a=>{try{d.value=!0;const e=await de(a.heritage_number);e.success?(l.success("删除成功"),f()):l.error(e.message||"删除失败")}catch(e){console.error("删除失败:",e),l.error(e.message||"删除失败")}finally{d.value=!1}};return Q(()=>u.value,()=>{i.page=1;const a=setTimeout(()=>{f(),clearTimeout(a)},500)}),W(()=>{f()}),(a,e)=>(w(),j("div",ce,[o(r(J),{"has-sider":"",class:"h-full w-full"},{default:c(()=>[o(r(G),{class:"h-full flex flex-col"},{default:c(()=>[e[10]||(e[10]=p("div",{class:"header-section"},[p("div",{class:"header-title"},"非遗技艺"),p("div",{class:"header-placeholder"})],-1)),p("div",pe,[p("div",ge,[o(r(B),{value:u.value,"onUpdate:value":e[0]||(e[0]=t=>u.value=t),placeholder:"搜索关键词",clearable:"",class:"search-input"},{suffix:c(()=>[o(r(N),{icon:"ri:search-line"})]),_:1},8,["value"])]),p("div",fe,[o(r(D),{type:"primary",class:"add-btn",onClick:P},{icon:c(()=>[o(r(N),{icon:"ri:add-line"})]),default:c(()=>[e[9]||(e[9]=F(" 新增非遗 ",-1))]),_:1})])]),p("div",me,[p("div",ve,[p("div",he,[p("div",be,[o(r(ee),{columns:L.value,data:x.value,pagination:!1,"row-key":t=>t.heritage_number,"checked-row-keys":z.value,"onUpdate:checkedRowKeys":e[1]||(e[1]=t=>z.value=t),loading:d.value,striped:""},null,8,["columns","data","row-key","checked-row-keys","loading"])]),p("div",_e,[p("span",ye,"共"+I(i.itemCount)+"条",1),o(r(ae),{page:i.page,"onUpdate:page":[e[2]||(e[2]=t=>i.page=t),i.onUpdatePage],"page-size":i.pageSize,"onUpdate:pageSize":[e[3]||(e[3]=t=>i.pageSize=t),i.onUpdatePageSize],"item-count":i.itemCount,"page-sizes":i.pageSizes,"show-size-picker":"","page-slot":7},{suffix:c(()=>[p("span",ke,I(i.pageSize)+"条/页",1)]),_:1},8,["page","page-size","item-count","page-sizes","onUpdate:page","onUpdate:pageSize"])])])])])]),_:1})]),_:1}),o(r(Y),{show:h.value,"onUpdate:show":e[7]||(e[7]=t=>h.value=t),"show-icon":!1,preset:"dialog",title:m.value?"编辑非遗":"新增非遗","positive-text":"提交","negative-text":"取消",onPositiveClick:$,onNegativeClick:e[8]||(e[8]=t=>h.value=!1),style:{width:"600px"},class:"heritage-modal"},{default:c(()=>[o(r(te),{ref_key:"addFormRef",ref:S,model:s,rules:{heritageName:{required:!0,message:"请输入非遗名称",trigger:"blur"},questionBank:m.value?{}:{required:!0,message:"请选择互动题库",trigger:"change"}},"label-placement":"top"},{default:c(()=>[o(r(C),{label:"非遗名称",path:"heritageName"},{default:c(()=>[o(r(B),{value:s.heritageName,"onUpdate:value":e[4]||(e[4]=t=>s.heritageName=t),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1}),m.value?H("",!0):(w(),M(r(C),{key:0,label:"互动题库",path:"questionBank"},{default:c(()=>[o(r(X),{value:s.questionBank,"onUpdate:value":e[5]||(e[5]=t=>s.questionBank=t),options:v.value,placeholder:"请选择题库",clearable:""},null,8,["value","options"])]),_:1})),m.value?H("",!0):(w(),M(r(C),{key:1,label:"视频文件",path:"files"},{default:c(()=>[o(r(se),{"file-list":s.files,"onUpdate:fileList":e[6]||(e[6]=t=>s.files=t),max:1,"before-upload":V,onChange:T,"default-upload":!1,"list-type":"text"},{default:c(()=>[o(r(D),{text:"",type:"info"},{icon:c(()=>[o(r(N),{icon:"ri:upload-cloud-line"})]),default:c(()=>[e[11]||(e[11]=F(" 点击上传视频 ",-1))]),_:1})]),_:1},8,["file-list"]),e[12]||(e[12]=p("div",{style:{color:"#999","font-size":"12px","margin-top":"8px"}}," 支持 mp4, avi, mov, wmv, flv, mkv, webm 格式，文件大小不超过 100MB ",-1))]),_:1}))]),_:1},8,["model","rules"])]),_:1},8,["show","title"])]))}});const Fe=Z(we,[["__scopeId","data-v-b4ed6864"]]);export{Fe as default};
