import{d as R,r as u,a2 as V,bS as _,n as S,a4 as Z,$ as A,o as K,c as Y,b as s,ab as o,R as l,w as h,bU as E,a as d,N as B,ah as k,ac as x,a5 as q,a6 as z,bW as O,aS as G,ad as H,b6 as J}from"./index-fc2ca07d.js";import{N as Q}from"./DataTable-2e69da2a.js";import{N as W}from"./Pagination-078592c4.js";import{N as j}from"./Form-97fa87e1.js";import{N as b}from"./FormItem-9918da75.js";import{N as ee}from"./Upload-7895b36e.js";import"./Forward-86f34074.js";const ae={class:"heritage-container"},te={class:"search-section"},ie={class:"search-wrapper"},se={class:"add-wrapper"},le={class:"content-section"},ne={class:"content-wrapper"},oe={class:"table-container"},de={class:"table-wrapper"},re={class:"pagination-wrapper"},ue={class:"total-count"},pe={style:{"margin-left":"8px"}},ce=R({__name:"index",setup(ge){const p=u(null),m=u([{label:"厦门南音题库",value:"bank1"},{label:"厦门传统技艺题库",value:"bank2"},{label:"厦门民俗文化题库",value:"bank3"},{label:"厦门戏曲艺术题库",value:"bank4"}]),f=V(),r=u([{id:1,heritageCode:"XM20240315NY001",heritageName:"厦门南音传统曲目教学",questionBank:"厦门南音题库",updateTime:"2025-03-15 09:30:15",published:!0},{id:2,heritageCode:"XM20240318QX002",heritageName:"厦门漆线雕制作技艺",questionBank:"厦门传统技艺题库",updateTime:"2025-03-18 14:22:38",published:!0},{id:3,heritageCode:"XM20240320MO003",heritageName:"厦门木偶戏表演艺术",questionBank:"厦门戏曲艺术题库",updateTime:"2025-03-20 11:15:42",published:!1},{id:4,heritageCode:"XM20240322GZ004",heritageName:"歌仔戏唱腔与表演",questionBank:"厦门戏曲艺术题库",updateTime:"2025-03-22 16:45:20",published:!0},{id:5,heritageCode:"XM20240325DZ005",heritageName:"答嘴鼓说唱艺术",questionBank:"厦门民俗文化题库",updateTime:"2025-03-25 10:30:55",published:!1},{id:6,heritageCode:"XM20240328ZS006",heritageName:"厦门珠绣传统工艺",questionBank:"厦门传统技艺题库",updateTime:"2025-03-28 13:20:10",published:!0},{id:7,heritageCode:"XM20240401MN007",heritageName:"闽南传统民居营造技艺",questionBank:"厦门传统技艺题库",updateTime:"2025-04-01 08:55:30",published:!1},{id:8,heritageCode:"XM20240405BS008",heritageName:"保生大帝信俗文化",questionBank:"厦门民俗文化题库",updateTime:"2025-04-05 15:40:18",published:!0},{id:9,heritageCode:"XM20240408ZB009",heritageName:"中秋博饼传统习俗",questionBank:"厦门民俗文化题库",updateTime:"2025-04-08 12:25:45",published:!0},{id:10,heritageCode:"XM20240410TS010",heritageName:"厦门同安锡雕技艺",questionBank:"厦门传统技艺题库",updateTime:"2025-04-10 09:15:22",published:!1},{id:11,heritageCode:"XM20240412XH011",heritageName:"厦门翔安拍胸舞",questionBank:"厦门民俗文化题库",updateTime:"2025-04-12 14:30:50",published:!1},{id:12,heritageCode:"XM20240415LY012",heritageName:"闽南语童谣传承",questionBank:"厦门民俗文化题库",updateTime:"2025-04-15 11:45:33",published:!0}]),N=u([]),c=u(!1),C=u(null),n=_({heritageName:"",questionBank:null,files:[]}),M=u((()=>[{title:"非遗编号",key:"heritageCode",width:180},{title:"非遗名称",key:"heritageName",width:200},{title:"互动题库",key:"questionBank",width:200},{title:"更新时间",key:"updateTime",width:200},{title:"操作",key:"actions",width:220,render:t=>h("div",{class:"action-cell",style:"display: inline-flex; align-items: center; gap: 8px;"},[h("span",{class:"action-link publish",style:{fontSize:"14px",color:"#1890ff",cursor:"pointer"},onClick:()=>F(t)},"发布"),h("span",{class:"action-divider",style:{color:"#d9d9d9"}},"|"),h("span",{class:"action-link edit",style:{fontSize:"14px",color:"#1890ff",cursor:"pointer"},onClick:()=>P(t)},"编辑"),h("span",{class:"action-divider",style:{color:"#d9d9d9"}},"|"),h("span",{class:"action-link delete",style:{fontSize:"14px",color:"#ff4d4f",cursor:"pointer"},onClick:()=>$(t.id)},"删除")])}])()),i=_({page:1,pageSize:10,itemCount:0,pageSizes:[10,20,30,50],showSizePicker:!0,onUpdatePage:t=>{i.page=t,g()},onUpdatePageSize:t=>{i.pageSize=t,i.page=1,g()}}),g=()=>{i.itemCount=w.value.length},w=S(()=>{let t=r.value;if(p.value&&p.value.trim()){const e=p.value.trim().toLowerCase();t=t.filter(a=>a.heritageName.toLowerCase().includes(e)||a.heritageCode.toLowerCase().includes(e)||a.questionBank.toLowerCase().includes(e))}return t}),T=S(()=>{const t=(i.page-1)*i.pageSize,e=t+i.pageSize;return w.value.slice(t,e)}),U=()=>{n.heritageName="",n.questionBank=null,n.files=[],c.value=!0},X=t=>{n.files=t.fileList},D=t=>{const e=t.file.file;return e?e.size/1024/1024<10?!0:(f.error("文件大小不能超过 10MB"),!1):!0},L=()=>{var t;(t=C.value)==null||t.validate(e=>{var a;if(!e){const y=r.value.length>0?Math.max(...r.value.map(v=>v.id))+1:1,I=`SN${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}XJ${String(y).padStart(3,"0")}`;r.value.push({id:y,heritageCode:I,heritageName:n.heritageName,questionBank:((a=m.value.find(v=>v.value===n.questionBank))==null?void 0:a.label)||"",updateTime:new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-"),published:!1}),g(),c.value=!1,f.success("新增非遗成功")}})},F=t=>{const e=r.value.findIndex(a=>a.id===t.id);e!==-1&&(r.value[e].published=!0,f.success("发布成功"))},P=t=>{var e;n.heritageName=t.heritageName,n.questionBank=((e=m.value.find(a=>a.label===t.questionBank))==null?void 0:e.value)||null,n.files=[],c.value=!0},$=t=>{r.value=r.value.filter(e=>e.id!==t),g(),f.success("删除成功")};return Z(()=>p.value,()=>{i.page=1,g()}),A(()=>{g()}),(t,e)=>(K(),Y("div",ae,[s(l(O),{"has-sider":"",class:"h-full w-full"},{default:o(()=>[s(l(E),{class:"h-full flex flex-col"},{default:o(()=>[e[10]||(e[10]=d("div",{class:"header-section"},[d("div",{class:"header-title"},"非遗技艺"),d("div",{class:"header-placeholder"})],-1)),d("div",te,[d("div",ie,[s(l(B),{value:p.value,"onUpdate:value":e[0]||(e[0]=a=>p.value=a),placeholder:"搜索关键词",clearable:"",class:"search-input"},{suffix:o(()=>[s(l(k),{icon:"ri:search-line"})]),_:1},8,["value"])]),d("div",se,[s(l(x),{type:"primary",class:"add-btn",onClick:U},{icon:o(()=>[s(l(k),{icon:"ri:add-line"})]),default:o(()=>[e[9]||(e[9]=q(" 新增非遗 "))]),_:1})])]),d("div",le,[d("div",ne,[d("div",oe,[d("div",de,[s(l(Q),{columns:M.value,data:T.value,pagination:!1,"row-key":a=>a.id,"checked-row-keys":N.value,"onUpdate:checkedRowKeys":e[1]||(e[1]=a=>N.value=a),striped:""},null,8,["columns","data","row-key","checked-row-keys"])]),d("div",re,[d("span",ue,"共"+z(i.itemCount)+"条",1),s(l(W),{page:i.page,"onUpdate:page":[e[2]||(e[2]=a=>i.page=a),i.onUpdatePage],"page-size":i.pageSize,"onUpdate:pageSize":[e[3]||(e[3]=a=>i.pageSize=a),i.onUpdatePageSize],"item-count":i.itemCount,"page-sizes":i.pageSizes,"show-size-picker":"","page-slot":7},{suffix:o(()=>[d("span",pe,z(i.pageSize)+"条/页",1)]),_:1},8,["page","page-size","item-count","page-sizes","onUpdate:page","onUpdate:pageSize"])])])])])]),_:1})]),_:1}),s(l(H),{show:c.value,"onUpdate:show":e[7]||(e[7]=a=>c.value=a),"show-icon":!1,preset:"dialog",title:"新增非遗","positive-text":"提交","negative-text":"取消",onPositiveClick:L,onNegativeClick:e[8]||(e[8]=a=>c.value=!1),style:{width:"600px"},class:"heritage-modal"},{default:o(()=>[s(l(j),{ref_key:"addFormRef",ref:C,model:n,rules:{heritageName:{required:!0,message:"请输入非遗名称",trigger:"blur"},questionBank:{required:!0,message:"请选择互动题库",trigger:"change"}},"label-placement":"top"},{default:o(()=>[s(l(b),{label:"非遗名称",path:"heritageName"},{default:o(()=>[s(l(B),{value:n.heritageName,"onUpdate:value":e[4]||(e[4]=a=>n.heritageName=a),placeholder:"请输入",clearable:""},null,8,["value"])]),_:1}),s(l(b),{label:"互动题库",path:"questionBank"},{default:o(()=>[s(l(G),{value:n.questionBank,"onUpdate:value":e[5]||(e[5]=a=>n.questionBank=a),options:m.value,placeholder:"请选择题库",clearable:""},null,8,["value","options"])]),_:1}),s(l(b),{label:"文件资料",path:"files"},{default:o(()=>[s(l(ee),{"file-list":n.files,"onUpdate:fileList":e[6]||(e[6]=a=>n.files=a),max:5,"before-upload":D,onChange:X,"default-upload":!1,"list-type":"text"},{default:o(()=>[s(l(x),{text:"",type:"info"},{icon:o(()=>[s(l(k),{icon:"ri:upload-cloud-line"})]),default:o(()=>[e[11]||(e[11]=q(" 点击上传 "))]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}});const we=J(ce,[["__scopeId","data-v-b4a6221e"]]);export{we as default};
