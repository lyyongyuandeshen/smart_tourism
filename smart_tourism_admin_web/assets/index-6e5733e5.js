import{d as U,o as d,c as g,a as l,X,aa as F,a6 as $,Q as S,a8 as k,R as n,N as j,aS as O,a1 as q,b as c,ab as v,ah as A,a5 as V,b7 as L,r as h,bX as Q,ad as G,bR as H,bS as J,n as D,w as K}from"./index-5805bd08.js";import{M as f,P as W}from"./index-081a0759.js";import{N as Y}from"./DatePicker-8deac17c.js";import{N as Z}from"./DataTable-f0affd58.js";import"./Pagination-78bedb34.js";import"./Forward-dbe0c59b.js";const ee={class:"flex items-start"},ae={class:"text-sm text-[#4E5969] whitespace-nowrap"},te={class:"w-[6.875rem] pl-5 flex flex-col gap-5 border-l border-[#E5E6EB]"},le={class:"flex items-center gap-2"},ne={class:"flex items-center gap-2"},se=U({__name:"index",props:{fields:{},cols:{},modelValue:{}},emits:["update:modelValue","search","reset"],setup(i,{emit:y}){const m=y,p=()=>{m("search")},u=()=>{m("reset")};return(N,r)=>(d(),g("div",ee,[l("div",{class:k(["flex flex-1 grid",`grid-cols-${i.cols||3} gap-4 pr-5`])},[(d(!0),g(X,null,F(i.fields,e=>(d(),g("div",{key:e.name,class:"flex items-center gap-4"},[l("label",ae,$(e.label),1),e.type==="input"?(d(),S(n(j),{key:0,value:i.modelValue[e.name],"onUpdate:value":s=>i.modelValue[e.name]=s,placeholder:e.placeholder,class:k(e.class)},null,8,["value","onUpdate:value","placeholder","class"])):e.type==="select"?(d(),S(n(O),{key:1,value:i.modelValue[e.name],"onUpdate:value":s=>i.modelValue[e.name]=s,options:e.options,placeholder:e.placeholder,class:k(e.class)},null,8,["value","onUpdate:value","options","placeholder","class"])):e.type==="date"?(d(),S(n(Y),{key:2,value:i.modelValue[e.name],"onUpdate:value":s=>i.modelValue[e.name]=s,type:"date",placeholder:e.placeholder,class:k(`flex-1 ${e.class||""}`)},null,8,["value","onUpdate:value","placeholder","class"])):q("",!0)]))),128))],2),l("div",te,[c(n(f),{type:"primary",onClick:p},{default:v(()=>[l("div",le,[c(n(A),{icon:"ri:search-2-line"}),r[0]||(r[0]=V(" 查询 ",-1))])]),_:1}),c(n(f),{reset:"",onClick:u},{default:v(()=>[l("div",ne,[c(n(A),{icon:"ri:refresh-line"}),r[1]||(r[1]=V(" 重置 ",-1))])]),_:1})])]))}}),oe=L(se,[["__scopeId","data-v-2b007124"]]),re={class:"flex items-center"},ce={class:"flex items-center"},ie={class:"flex justify-center items-center"},ue={class:"flex justify-end gap-2 p-4"},de=U({__name:"AdjustSharingModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirm"],setup(i,{emit:y}){const m=y,p=h([{id:1,channel:"渠道1",ratio:6},{id:2,channel:"渠道2",ratio:5},{id:3,channel:"渠道3",ratio:4}]),u=()=>{m("update:modelValue",!1)},N=()=>{m("confirm",p.value.map(r=>({channel:r.channel,ratio:r.ratio}))),u()};return(r,e)=>(d(),S(n(G),{show:i.modelValue,"onUpdate:show":e[0]||(e[0]=s=>m("update:modelValue",s)),title:"调整分账规则",preset:"card",style:{width:"800px"}},{footer:v(()=>[l("div",ue,[c(n(f),{onClick:u},{default:v(()=>[...e[3]||(e[3]=[V("取消",-1)])]),_:1}),c(n(f),{type:"primary",onClick:N},{default:v(()=>[...e[4]||(e[4]=[V("确定",-1)])]),_:1})])]),default:v(()=>[l("div",null,[e[2]||(e[2]=l("div",{class:"grid grid-cols-3 gap-4 p-4 bg-gray-50"},[l("div",{class:"font-medium"},"序号"),l("div",{class:"font-medium"},"渠道"),l("div",{class:"font-medium text-center"},"分配比例")],-1)),(d(!0),g(X,null,F(p.value,(s,_)=>(d(),g("div",{key:_,class:"grid grid-cols-3 gap-4 px-4 py-2 border-b border-gray-100"},[l("div",re,$(s.id),1),l("div",ce,$(s.channel),1),l("div",ie,[c(n(Q),{value:s.ratio,"onUpdate:value":x=>s.ratio=x,min:0,max:100,placeholder:"请输入比例",class:"w-28"},null,8,["value","onUpdate:value"]),e[1]||(e[1]=l("span",{class:"ml-2"},"%",-1))])]))),128))])]),_:1},8,["show"]))}}),me={class:"p-6 h-full bg-white"},pe={class:"px-2 mb-5"},he={class:"mb-5 flex gap-2"},ve={class:"rounded-lg overflow-hidden"},ke=U({__name:"index",setup(i){const y=H(),m=[{label:"全部",value:""},{label:"XXX景点",value:"1"}],p=[{label:"全部",value:""},{label:"渠道1",value:"channel1"},{label:"渠道2",value:"channel2"},{label:"渠道3",value:"channel3"}],u=h(1),N=h(50),r=h(10),e=J({productName:"",scenicName:null,channel:null,orderDate:null}),s=[{label:"商品名称",name:"productName",type:"input",placeholder:"请输入商品名称"},{label:"景点名称",name:"scenicName",type:"select",placeholder:"请选择景点",options:m},{label:"渠道",name:"channel",type:"select",placeholder:"全部",options:p},{label:"下单时间",name:"orderDate",type:"date",placeholder:"请选择日期"}],_=h(Array(10).fill(0).map((a,t)=>{const o=t%3,b=t%3+1;return{id:t+1,orderNo:`SN20241018XX${String(t+1).padStart(3,"0")}`,productName:"XXX景点门票",quantity:b,totalAmount:b===1?50:b===2?100:150,sharingAmount:b===1?3:b===2?5:6,scenicName:"XXX景点",channel:o===0?"渠道1":o===1?"渠道2":"渠道3",orderTime:"2025-03-10 12:54:21"}})),x=D(()=>_.value.filter(a=>{if(e.productName&&!a.productName.includes(e.productName))return!1;if(e.scenicName&&e.scenicName!==""){const t=m.find(o=>o.value===e.scenicName);if(t&&a.scenicName!==t.label)return!1}if(e.channel&&e.channel!==""){const t=p.find(o=>o.value===e.channel);if(t&&a.channel!==t.label)return!1}return!0})),B=D(()=>{const a=(u.value-1)*r.value,t=a+r.value;return x.value.slice(a,t)}),T=()=>{e.productName="",e.scenicName=null,e.channel=null,e.orderDate=null,u.value=1},w=()=>{u.value=1,M()},M=()=>{N.value=x.value.length},R=a=>{console.log("分账结算:",a),y.push({name:"FinanceSettlement",params:{orderId:a.id},query:{orderNo:a.orderNo,scenicName:a.scenicName,channel:a.channel,orderTime:a.orderTime,totalAmount:a.totalAmount,sharingAmount:a.sharingAmount,productName:a.productName}})},z=()=>{console.log("生成票务销售报表")},C=h(!1),E=()=>{C.value=!0},I=[{title:"订单号",key:"orderNo"},{title:"商品名称",key:"productName"},{title:"数量",key:"quantity",align:"center"},{title:"总计(元)",key:"totalAmount",align:"center",render:a=>`${a.totalAmount.toFixed(2)}`},{title:"分账金额(元)",key:"sharingAmount",align:"center"},{title:"景点名称",key:"scenicName"},{title:"渠道",key:"channel"},{title:"下单时间",key:"orderTime"},{title:"操作",key:"action",align:"center",render:a=>K("button",{class:"text-[#165DFF]",onClick:()=>R(a)},"分账结算")}],P=a=>{console.log("确认分账规则:",a)};return(a,t)=>(d(),g(X,null,[l("div",me,[t[4]||(t[4]=l("h2",{class:"text-[#1D2129] mb-6"},"票务对账",-1)),l("div",pe,[c(n(oe),{fields:s,cols:3,modelValue:e,"onUpdate:modelValue":t[0]||(t[0]=o=>e=o),onSearch:w,onReset:T},null,8,["modelValue"])]),l("div",he,[c(n(f),{type:"primary",text:"生成票务销售报表",onClick:z}),c(n(f),{text:"调整自动分账比例",onClick:E})]),l("div",ve,[c(n(Z),{columns:I,data:B.value,bordered:!1,class:"w-full",pagination:!1},null,8,["data"])]),c(n(W),{"total-count":N.value,"current-page":u.value,"onUpdate:currentPage":t[1]||(t[1]=o=>u.value=o),"page-size":r.value,"onUpdate:pageSize":t[2]||(t[2]=o=>r.value=o)},null,8,["total-count","current-page","page-size"])]),c(de,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=o=>C.value=o),onConfirm:P},null,8,["modelValue"])],64))}});export{ke as default};
