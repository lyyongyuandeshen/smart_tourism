import{d as X,o as _,c as k,a as i,a6 as F,X as C,aa as H,a8 as Q,Q as E,R as o,c3 as R,a1 as T,r as m,a4 as W,ab as w,b as s,bX as z,ad as P,n as V,aS as M,w as S,b6 as j,ah as q,a5 as G,N as J}from"./index-fc2ca07d.js";import{M as x,P as A}from"./index-4734ee68.js";import{M as L}from"./index-0ccb7711.js";import{N as O}from"./DataTable-2e69da2a.js";import{N as K}from"./Upload-7895b36e.js";import"./Pagination-078592c4.js";import"./Forward-86f34074.js";const Y={class:"ticket-header flex items-center justify-center relative"},Z={class:"text-[#1D2129] absolute left-0"},ee={class:"text-[#4E5969] text-[1.25rem] flex items-center"},te=["onClick"],ae=X({__name:"index",props:{title:{},items:{},modelValue:{}},emits:["update:modelValue"],setup(y,{emit:n}){const u=n,d=c=>{u("update:modelValue",c)};return(c,v)=>(_(),k("div",Y,[i("div",Z,F(c.title),1),i("div",ee,[(_(!0),k(C,null,H(c.items,(p,f)=>(_(),k(C,{key:f},[i("span",{class:Q([{"text-[#235FC8]":c.modelValue===f},"cursor-pointer"]),onClick:r=>d(f)},F(p),11,te),f<c.items.length-1?(_(),E(o(R),{key:0,vertical:""})):T("",!0)],64))),128))])]))}}),le={class:"mb-5"},se={class:"flex items-center w-[calc(50%-1.25rem)]"},oe={class:"flex gap-5"},ne={class:"flex justify-end gap-2 p-4"},ue=X({__name:"StockSettingsModal",props:{modelValue:{type:Boolean},material:{}},emits:["update:modelValue","confirm"],setup(y,{emit:n}){const u=y,d=n,c=m(12),v=m(0),p=m(0);W(()=>u.material,g=>{g&&(v.value=g.safetyStockMin,p.value=g.safetyStockMax)},{immediate:!0});const f=()=>{u.material&&d("confirm",{materialId:u.material.id,autoUpdateInterval:c.value,safetyStockMin:v.value,safetyStockMax:p.value}),r()},r=()=>{d("update:modelValue",!1)};return(g,l)=>(_(),E(o(P),{show:g.modelValue,"onUpdate:show":l[3]||(l[3]=b=>d("update:modelValue",b)),title:"编辑库存信息",preset:"card",style:{width:"700px"}},{footer:w(()=>[i("div",ne,[s(o(x),{text:"取消",onClick:r}),s(o(x),{type:"primary",text:"确定",onClick:f})])]),default:w(()=>[i("div",le,[l[5]||(l[5]=i("label",{class:"block text-[#4E5969] mb-2"},"设定自动计算时间间隔",-1)),i("div",se,[s(o(z),{value:c.value,"onUpdate:value":l[0]||(l[0]=b=>c.value=b),class:"flex-1",min:1},null,8,["value"]),l[4]||(l[4]=i("span",{class:"ml-2"},"小时",-1))])]),l[6]||(l[6]=i("div",{class:"flex mb-2"},[i("label",{class:"text-[#4E5969]"},"安全库存下限"),i("label",{class:"text-[#4E5969] ml-auto"},"安全库存上限")],-1)),i("div",oe,[s(o(z),{value:v.value,"onUpdate:value":l[1]||(l[1]=b=>v.value=b),class:"flex-1",min:0},null,8,["value"]),s(o(z),{value:p.value,"onUpdate:value":l[2]||(l[2]=b=>p.value=b),class:"flex-1",min:0},null,8,["value"])])]),_:1},8,["show"]))}}),re={class:"mb-5 flex items-center gap-4 justify-between"},ie={class:"flex items-center gap-4"},de={class:"rounded-lg overflow-hidden"},ce=X({__name:"Materials",setup(y){const n=m(null),u=m(null),d=m(!1),c=m(null),v=m(Array(10).fill(0).map((t,e)=>{let a;return e%3===0?a="正常":e%3===1?a="低库存预警":a="高库存预警",{id:e+1,materialName:e%3===0?"XXX物资1":e%3===1?"XXX物资2":"XXX物资3",stockCount:e%3===0?100:200,warningStatus:a,safetyStockMin:e%3===1?150:e%3===2?20:100,safetyStockMax:e%3===0?300:e%3===1?500:220,updateTime:"2025-03-10 12:54:21"}})),p=[{label:"全部",value:""},{label:"XXX物资1",value:"1"},{label:"XXX物资2",value:"2"},{label:"XXX物资3",value:"3"}],f=[{label:"全部",value:""},{label:"正常",value:"normal"},{label:"低库存预警",value:"low"},{label:"高库存预警",value:"high"}],r=m(1),g=m(50),l=m(10),b=V(()=>v.value.filter(t=>{if(n.value&&n.value!==""){const e=p.find(a=>a.value===n.value);if(e&&t.materialName!==e.label)return!1}if(u.value&&u.value!==""){let e="";if(u.value==="normal"?e="正常":u.value==="low"?e="低库存预警":u.value==="high"&&(e="高库存预警"),t.warningStatus!==e)return!1}return!0})),N=V(()=>{const t=(r.value-1)*l.value,e=t+l.value;return b.value.slice(t,e)}),h=()=>{g.value=b.value.length,r.value=1},$=t=>{let e="";return t==="正常"?e="success":t==="低库存预警"?e="warning":t==="高库存预警"&&(e="error"),S(L,{type:e,content:t})},U=t=>{c.value=t,d.value=!0},B=t=>{const e=v.value.findIndex(a=>a.id===t.materialId);if(e!==-1){v.value[e].safetyStockMin=t.safetyStockMin,v.value[e].safetyStockMax=t.safetyStockMax,v.value[e].updateTime=new Date().toLocaleString("zh-CN");const a=v.value[e].stockCount;a<t.safetyStockMin?v.value[e].warningStatus="低库存预警":a>t.safetyStockMax?v.value[e].warningStatus="高库存预警":v.value[e].warningStatus="正常",h()}},I=[{title:"物资名称",key:"materialName"},{title:"库存数量",key:"stockCount"},{title:"预警状态",key:"warningStatus",render(t){return $(t.warningStatus)}},{title:"安全库存下限",key:"safetyStockMin"},{title:"安全库存上限",key:"safetyStockMax"},{title:"更新时间",key:"updateTime"},{title:"操作",key:"action",render(t){return S("button",{class:"text-[#165DFF]",onClick:()=>U(t)},"库存设置")}}],D=()=>{console.log("上传库存历史台账")};return(t,e)=>(_(),k(C,null,[i("div",re,[i("div",ie,[s(o(M),{value:n.value,"onUpdate:value":e[0]||(e[0]=a=>n.value=a),options:p,placeholder:"物资名称",class:"!w-[13.75rem] !rounded"},null,8,["value"]),s(o(M),{value:u.value,"onUpdate:value":e[1]||(e[1]=a=>u.value=a),options:f,placeholder:"预警状态",class:"!w-[13.75rem] !rounded"},null,8,["value"])]),s(o(x),{type:"primary",onClick:D,text:"+ 上传库存历史台账"})]),i("div",de,[s(o(O),{columns:I,data:N.value,bordered:!1,class:"w-full",pagination:!1},null,8,["data"]),s(o(A),{"total-count":g.value,"current-page":r.value,"onUpdate:currentPage":e[2]||(e[2]=a=>r.value=a),"page-size":l.value,"onUpdate:pageSize":e[3]||(e[3]=a=>l.value=a)},null,8,["total-count","current-page","page-size"])]),s(ue,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),material:c.value,onConfirm:B},null,8,["modelValue","material"])],64))}});const me=j(ce,[["__scopeId","data-v-1be9fcfb"]]),ve={class:"mb-5"},pe={class:"cursor-pointer flex items-center gap-2 text-[#165DFF]"},fe={class:"flex justify-end gap-2 p-4"},ge=X({__name:"VoucherUploadModal",props:{modelValue:{type:Boolean},selectedBudgetItem:{}},emits:["update:modelValue","confirm"],setup(y,{emit:n}){const u=y,d=n,c=m(null),v=()=>{d("confirm",u.selectedBudgetItem),p()},p=()=>{d("update:modelValue",!1)};return(f,r)=>{var g;return _(),E(o(P),{show:f.modelValue,"onUpdate:show":r[1]||(r[1]=l=>d("update:modelValue",l)),title:`当前节点：${(g=f.selectedBudgetItem)==null?void 0:g.currentNode}`,preset:"card",style:{width:"700px"}},{footer:w(()=>[i("div",fe,[s(o(x),{text:"取消",onClick:p}),s(o(x),{type:"primary",text:"确定",onClick:v})])]),default:w(()=>[i("div",ve,[r[3]||(r[3]=i("label",{class:"block text-[#4E5969] mb-2"},"凭证资料",-1)),s(o(K),{action:"/api/upload"},{default:w(()=>[i("div",pe,[s(o(q),{icon:"ri:upload-line"}),r[2]||(r[2]=G("上传文件 "))])]),_:1})]),r[4]||(r[4]=i("label",{class:"block text-[#4E5969] mb-2"},"凭证金额",-1)),s(o(J),{value:c.value,"onUpdate:value":r[0]||(r[0]=l=>c.value=l),type:"textarea",placeholder:"请输入.."},null,8,["value"])]),_:1},8,["show","title"])}}}),be={class:"mb-5 flex items-center gap-4 justify-between"},_e={class:"flex items-center gap-4"},ke={class:"rounded-lg overflow-hidden"},ye=X({__name:"Budget",setup(y){const n=m(null),u=m(null),d=m(!1),c=m(null),v=m(Array(10).fill(0).map((t,e)=>{const a=e%2===0;return{id:e+1,materialName:e%3===0?"XXX物资1":e%3===1?"XXX物资2":"XXX物资3",budgetAmount:e%3===0?100:200,actualExpense:e%3===0?100:200,budgetStatus:a?"正常":"超预算",currentNode:"节点1",updateTime:"2025-03-10 12:54:21"}})),p=[{label:"全部",value:""},{label:"XXX物资1",value:"1"},{label:"XXX物资2",value:"2"},{label:"XXX物资3",value:"3"}],f=[{label:"全部",value:""},{label:"正常",value:"normal"},{label:"超预算",value:"over"}],r=m(1),g=m(50),l=m(10),b=V(()=>v.value.filter(t=>{if(n.value&&n.value!==""){const e=p.find(a=>a.value===n.value);if(e&&t.materialName!==e.label)return!1}if(u.value&&u.value!==""){let e="";if(u.value==="normal"?e="正常":u.value==="over"&&(e="超预算"),t.budgetStatus!==e)return!1}return!0})),N=V(()=>{const t=(r.value-1)*l.value,e=t+l.value;return b.value.slice(t,e)}),h=t=>{let e="";return t==="正常"?e="success":t==="超预算"&&(e="error"),S(L,{type:e,content:t})},$=t=>{c.value=t,d.value=!0},U=t=>{console.log("编辑预算:",t)},B=t=>{d.value=!1},I=()=>{console.log("新建物资预算")},D=[{title:"物资名称",key:"materialName"},{title:"采购预算",key:"budgetAmount"},{title:"实际支出",key:"actualExpense"},{title:"预算预警",key:"budgetStatus",render(t){return h(t.budgetStatus)}},{title:"当前节点",key:"currentNode"},{title:"更新时间",key:"updateTime"},{title:"操作",key:"action",render(t){return S("div",[S("button",{class:"text-[#165DFF] mr-4",onClick:()=>U(t)},"编辑"),S("button",{class:"text-[#165DFF]",onClick:()=>$(t)},"上传凭证")])}}];return(t,e)=>(_(),k(C,null,[i("div",be,[i("div",_e,[s(o(M),{value:n.value,"onUpdate:value":e[0]||(e[0]=a=>n.value=a),options:p,placeholder:"物资名称",class:"!w-[13.75rem] !rounded"},null,8,["value"]),s(o(M),{value:u.value,"onUpdate:value":e[1]||(e[1]=a=>u.value=a),options:f,placeholder:"预算状态",class:"!w-[13.75rem] !rounded"},null,8,["value"])]),s(o(x),{type:"primary",onClick:I,text:"+ 新建物资预算"})]),i("div",ke,[s(o(O),{columns:D,data:N.value,bordered:!1,class:"w-full",pagination:!1},null,8,["data"]),s(o(A),{"total-count":g.value,"current-page":r.value,"onUpdate:currentPage":e[2]||(e[2]=a=>r.value=a),"page-size":l.value,"onUpdate:pageSize":e[3]||(e[3]=a=>l.value=a)},null,8,["total-count","current-page","page-size"])]),s(ge,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),selectedBudgetItem:c.value,onConfirm:B},null,8,["modelValue","selectedBudgetItem"])],64))}});const Se=j(ye,[["__scopeId","data-v-3bdf903f"]]),xe={class:"ticket px-6 pt-[1.375rem] bg-white h-full"},Xe={key:0,class:"mt-[1.375rem]"},we={key:1,class:"mt-[1.375rem]"},Ce={key:2,class:"mt-[1.375rem]"},Ie=X({__name:"index",setup(y){const n=m(1);return(u,d)=>(_(),k("div",xe,[s(o(ae),{title:"成本控制",items:["能耗智能分析","物资库存消耗","预算管理"],modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=c=>n.value=c)},null,8,["modelValue"]),n.value===0?(_(),k("div",Xe," 能耗智能分析开发中... ")):n.value===1?(_(),k("div",we,[s(me)])):n.value===2?(_(),k("div",Ce,[s(Se)])):T("",!0)]))}});export{Ie as default};
