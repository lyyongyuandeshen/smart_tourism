import{d as N,o as _,c as v,a as t,d6 as z,P as E,bR as F,au as M,a2 as T,bS as O,r as f,$ as W,n as j,b as r,ab as l,R as o,d7 as C,a5 as m,a6 as g,a1 as R,N as U,ca as w,ac as L,c3 as G,d8 as H,b6 as A}from"./index-fc2ca07d.js";import{g as $,s as Q,a as J}from"./sso-d78983d0.js";import{u as K,L as X}from"./LockClosedOutline-68879227.js";import{P as Y,L as Z}from"./PersonOutline-2bc06d6f.js";const ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},se=N({name:"LogoGoogle",render:function(p,c){return _(),v("svg",ee,c[0]||(c[0]=[t("path",{d:"M473.16 221.48l-2.26-9.59H262.46v88.22H387c-12.93 61.4-72.93 93.72-121.94 93.72c-35.66 0-73.25-15-98.13-39.11a140.08 140.08 0 0 1-41.8-98.88c0-37.16 16.7-74.33 41-98.78s61-38.13 97.49-38.13c41.79 0 71.74 22.19 82.94 32.31l62.69-62.36C390.86 72.72 340.34 32 261.6 32c-60.75 0-119 23.27-161.58 65.71C58 139.5 36.25 199.93 36.25 256s20.58 113.48 61.3 155.6c43.51 44.92 105.13 68.4 168.58 68.4c57.73 0 112.45-22.62 151.45-63.66c38.34-40.4 58.17-96.3 58.17-154.9c0-24.67-2.48-39.32-2.59-39.96z",fill:"currentColor"},null,-1)]))}}),oe={class:"login-container"},ae={class:"login-content"},te={class:"form-wrapper"},re={class:"form-content"},ne={class:"input-group"},le={class:"input-label-row"},ie={key:0,class:"error-message"},ce={class:"input-group"},ue={class:"input-label-row"},de={key:0,class:"error-message"},ge={class:"additional-links"},pe={class:"action-buttons"},me={class:"sso-login-section"},fe=N({__name:"index",setup(P){const{t:p}=z(),c=E(),x=F(),V=M(),n=T(),h=K(),u=O({username:"",password:""}),S=f(!1),b=f(!1),y=f(!1),d=f(null),i=O({username:"",password:""});function I(){let s=!0;return u.username?i.username="":(i.username=p("login.usernameRequired"),s=!1),u.password?i.password="":(i.password=p("login.passwordRequired"),s=!1),s}async function q(s){if(I())try{S.value=!0,await c.userLogin(u),n.success(p("login.loginSuccess")),x.push("/")}catch(e){n.error(e.message||p("login.loginFailed"))}finally{S.value=!1}}async function B(){try{if(b.value=!0,!d.value){const e=await $();if((e.success||e.code===200)&&e.data)d.value=e.data;else{n.error(e.message||e.msg||"获取SSO配置失败");return}}const s=`${window.location.origin}/#/login`;try{const e=await J(s);(e.success||e.code===200)&&e.data?e.data.auth_url?window.location.href=e.data.auth_url:typeof e.data=="string"?window.location.href=e.data:n.error("授权URL格式错误"):n.error(e.message||e.msg||"获取授权URL失败")}catch(e){console.error("获取授权URL失败，尝试直接跳转:",e),window.location.href=`${d.value.auth_url}/redirect?callback_url=${encodeURIComponent(s)}`}}catch(s){console.error("SSO登录错误:",s),n.error(s.message||"SSO登录失败")}finally{b.value=!1}}async function D(s){try{if(y.value=!0,!d.value){const a=await $();if((a.success||a.code===200)&&a.data)d.value=a.data;else{n.error(a.message||a.msg||"获取SSO配置失败");return}}const e=await Q({code:s,client_id:d.value.client_id,client_secret:d.value.client_secret||"b5hjzmqc62u0wx861q89t8mcjvh9f5gu"});if((e.success||e.code===200)&&e.data){e.access_token&&(localStorage.setItem("token",e.access_token),await c.userQrLogin(e.access_token)),e.data.user_info&&(c.updateUserInfo(e.data.user_info),c.recordState()),n.success("登录成功");const a=`${window.location.origin}${window.location.pathname}#/`;window.history.replaceState(null,"",a),x.replace("/")}else n.error(e.message||e.msg||"SSO登录失败")}catch(e){console.error("SSO登录错误:",e),n.error(e.message||"SSO登录失败")}finally{y.value=!1}}function k(s){return new URLSearchParams(window.location.search).get(s)||V.query[s]||null}return W(()=>{const s=k("code"),e=k("error");if(e){const a=k("error_description");n.error(a||e);return}s&&(console.log("检测到SSO回调，授权码:",s),D(s))}),j(()=>({background:h.value.bodyColor.startsWith("#1")||h.value.bodyColor.startsWith("#2")||h.value.bodyColor.startsWith("#3")?"linear-gradient(135deg, #003b8e, #0058d9)":"linear-gradient(135deg, #1867c0, #5cbbf6)"})),(s,e)=>(_(),v("div",oe,[r(o(H),{show:y.value},{default:l(()=>[t("div",ae,[t("div",te,[e[4]||(e[4]=t("div",{class:"login-methods"},[t("div",{class:"active-method"},"账号密码登录")],-1)),t("div",re,[t("div",ne,[t("div",le,[r(o(C),{strong:"",class:"input-label"},{default:l(()=>[m(g(s.$t("login.username")),1)]),_:1}),i.username?(_(),v("div",ie,g(i.username),1)):R("",!0)]),r(o(U),{value:u.username,"onUpdate:value":e[0]||(e[0]=a=>u.username=a),placeholder:s.$t("login.enterEmailOrPhone"),round:"",clearable:"",class:"custom-input",status:i.username?"error":void 0},{prefix:l(()=>[r(o(w),{component:o(Y)},null,8,["component"])]),_:1},8,["value","placeholder","status"])]),t("div",ce,[t("div",ue,[r(o(C),{strong:"",class:"input-label"},{default:l(()=>[m(g(s.$t("login.password")),1)]),_:1}),i.password?(_(),v("div",de,g(i.password),1)):R("",!0)]),r(o(U),{value:u.password,"onUpdate:value":e[1]||(e[1]=a=>u.password=a),type:"password",placeholder:s.$t("login.enterPassword"),round:"","show-password-on":"click",class:"custom-input",status:i.password?"error":void 0},{prefix:l(()=>[r(o(w),{component:o(X)},null,8,["component"])]),_:1},8,["value","placeholder","status"])]),t("div",ge,[r(o(L),{text:"",tag:"a",href:"#/resetpassword",class:"forgot-password"},{default:l(()=>[m(g(s.$t("login.forgotPassword")),1)]),_:1})]),t("div",pe,[r(o(L),{type:"primary",block:"",loading:S.value,onClick:q,class:"login-button"},{icon:l(()=>[r(o(w),{component:o(Z)},null,8,["component"])]),default:l(()=>[m(" "+g(s.$t("login.login")),1)]),_:1},8,["loading"])]),r(o(G),{style:{margin:"20px 0"}},{default:l(()=>e[2]||(e[2]=[t("span",{style:{"font-size":"12px",color:"var(--n-text-color-3)"}},"或",-1)])),_:1}),t("div",me,[r(o(L),{block:"",loading:b.value,onClick:B,class:"sso-login-button",quaternary:""},{icon:l(()=>[r(o(w),{component:o(se)},null,8,["component"])]),default:l(()=>[e[3]||(e[3]=m(" SSO 单点登录 "))]),_:1},8,["loading"])])])])])]),_:1},8,["show"])]))}});const Se=A(fe,[["__scopeId","data-v-b2a2840b"]]);export{Se as default};
