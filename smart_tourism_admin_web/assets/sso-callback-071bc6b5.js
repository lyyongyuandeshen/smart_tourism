import{d as v,bR as S,au as k,a2 as b,P as x,r as m,$ as y,o as _,c as w,a,b as C,ab as O,R,a6 as L,d9 as U,b7 as z}from"./index-5805bd08.js";import{g as B,s as P}from"./sso-22aeb8f7.js";const T={class:"sso-callback-container"},V={class:"callback-card"},$={class:"callback-content"},M={class:"status-icon"},j={key:0,class:"animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},q={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},E={class:"status-text"},N=v({__name:"sso-callback",setup(D){const n=S(),p=k(),l=b(),i=x(),c=m(!0),r=m("正在处理SSO登录...");function u(t){return new URLSearchParams(window.location.search).get(t)||p.query[t]||null}async function f(){const t=u("code"),e=u("error"),d=u("error_description");if(e){r.value=`登录失败: ${d||e}`,c.value=!1,l.error(d||e),setTimeout(()=>{n.replace("/login")},3e3);return}if(!t){r.value="缺少授权码",c.value=!1,console.error("SSO回调缺少授权码，当前URL:",window.location.href),l.error("SSO回调缺少授权码"),setTimeout(()=>{n.replace("/login")},3e3);return}console.log("SSO回调，授权码:",t);try{const s=await B();if(!(s.success||s.code===200)||!s.data)throw new Error(s.message||s.msg||"获取SSO配置失败");const g=s.data;r.value="正在验证授权...";const o=await P({code:t,client_id:g.client_id,client_secret:g.client_secret||"b5hjzmqc62u0wx861q89t8mcjvh9f5gu"});if((o.success||o.code===200)&&o.data){r.value="登录成功，正在跳转...",o.access_token&&await i.userQrLogin(o.access_token),o.data.user_info&&(i.updateUserInfo(o.data.user_info),i.recordState()),l.success("登录成功");const h=`${window.location.origin}${window.location.pathname}#/`;window.history.replaceState(null,"",h),setTimeout(()=>{n.replace("/")},1e3)}else throw new Error(o.message||o.msg||"SSO登录失败")}catch(s){r.value=`登录失败: ${s.message}`,c.value=!1,l.error(s.message||"SSO登录失败"),setTimeout(()=>{n.replace("/login")},3e3)}}return y(()=>{f()}),(t,e)=>(_(),w("div",T,[a("div",V,[C(R(U),{show:c.value,size:"large"},{default:O(()=>[a("div",$,[a("div",M,[c.value?(_(),w("svg",j,[...e[0]||(e[0]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(_(),w("svg",q,[...e[1]||(e[1]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])]))]),a("div",E,L(r.value),1)])]),_:1},8,["show"])])]))}});const H=z(N,[["__scopeId","data-v-9eb5948c"]]);export{H as default};
