import{d as B,bS as y,r as p,a2 as V,$ as q,o as k,c as T,b as o,ab as r,R as s,w as f,bU as L,a as i,N as v,aS as O,ac as N,ah as S,a5 as _,a6 as $,bW as K,Q,a1 as W,ad as E,b6 as G}from"./index-fc2ca07d.js";import{q as H,a as j}from"./merchant-67b4f163.js";import{N as J,a as X,b as z}from"./DataTable-2e69da2a.js";import{N as h}from"./Space-29132ab6.js";import{N as Y}from"./DatePicker-f677266b.js";import{N as Z}from"./Pagination-078592c4.js";import{N as ee}from"./Form-97fa87e1.js";import{N as U}from"./FormItem-9918da75.js";import"./Forward-86f34074.js";const te={class:"merchant-audit-container"},ae={class:"filter-section"},le={class:"filter-content"},se={class:"filter-item"},ie={class:"filter-item"},oe={class:"filter-item"},ne={class:"filter-item"},re={class:"filter-item"},ue={class:"filter-item"},pe={class:"filter-actions"},de={class:"content-section"},ce={class:"content-wrapper"},me={class:"table-container"},fe={class:"table-wrapper"},ve={class:"pagination-wrapper"},ge={class:"total-count"},_e=B({__name:"index",setup(be){const a=y({application_no:null,shop_name:null,status:null,business_scope:null,time:null,applicant_name:null}),C=p([{label:"全部状态",value:""},{label:"未完成",value:0},{label:"审核中",value:1},{label:"已完成",value:2}]),c=V(),g=p(!1),R=()=>{n.page=1,d()},D=()=>{a.application_no=null,a.shop_name=null,a.status=null,a.business_scope=null,a.time=null,a.applicant_name=null,n.page=1,d()},w=p([]),x=p([]),P={0:{label:"未完成",color:"#909399"},1:{label:"审核中",color:"#1890ff"},2:{label:"已完成",color:"#52c41a"},3:{label:"已撤回",color:"#faad14"}},m=p(!1),A=p(null),b=p(null),u=y({result:2,audit_comment:""}),F=p((()=>[{type:"selection"},{title:"申请编号",key:"application_no",width:120},{title:"店名",key:"shop_name",width:150},{title:"状态",key:"status",width:120,render:t=>{const e=P[t.status];return f("div",{class:"status-cell",style:"display: inline-flex; align-items: center; gap: 6px;"},[f("span",{class:"status-dot",style:{width:"8px",height:"8px",minWidth:"8px",minHeight:"8px",borderRadius:"50%",display:"inline-block",flexShrink:"0",backgroundColor:e.color}}),f("span",{class:"status-text",style:"font-size: 14px; color: #333;"},e.label)])}},{title:"申请人",key:"applicant_name",width:120},{title:"经营范围",key:"business_scope",width:200},{title:"创建时间",key:"created_time",width:180,render:t=>t.created_time?new Date(t.created_time).toLocaleString("zh-CN"):"-"},{title:"操作",key:"actions",width:120,render:t=>{const e=t.status===1;return f("div",{class:"action-cell",style:"display: inline-flex; align-items: center; gap: 8px;"},[f("span",{class:"action-link audit",style:{fontSize:"14px",color:e?"#1890ff":"#ccc",cursor:e?"pointer":"not-allowed"},onClick:()=>{e&&I(t)}},"准入审核")])}}])()),n=y({page:1,pageSize:10,itemCount:0,pageSizes:[10,20,30,50],showSizePicker:!0,onUpdatePage:t=>{n.page=t,d()},onUpdatePageSize:t=>{n.pageSize=t,n.page=1,d()}}),d=async()=>{try{g.value=!0;const t={page:n.page,page_size:n.pageSize};a.application_no&&(t.application_no=a.application_no),a.shop_name&&(t.shop_name=a.shop_name),a.status!==null&&a.status!==""&&(t.status=a.status),a.business_scope&&(t.business_scope=a.business_scope),a.applicant_name&&(t.applicant_name=a.applicant_name),a.time&&a.time.length===2&&(t.start_date=new Date(a.time[0]).toISOString().split("T")[0],t.end_date=new Date(a.time[1]).toISOString().split("T")[0]);const e=await H(t);console.log("商户审核列表返回:",e),e.success?(w.value=e.data,n.itemCount=e.total):c.error(e.message||"获取数据失败")}catch(t){console.error("获取商户申请列表失败:",t),c.error(t.message||"获取数据失败")}finally{g.value=!1}},I=t=>{b.value=t,u.result=2,u.audit_comment="",m.value=!0},M=async()=>{try{if(console.log("auditFormRef.value",u),b.value){const t=await j({application_no:b.value.application_no,status:u.result,audit_comment:u.audit_comment||void 0});console.log("审核返回:",t),t.success?(c.success(t.message||"审核成功"),m.value=!1,d()):c.error(t.message||"审核失败")}}catch(t){console.error("审核失败:",t),c.error(t.message||"审核失败")}};return q(()=>{d()}),(t,e)=>(k(),T("div",te,[o(s(K),{"has-sider":"",class:"h-full w-full"},{default:r(()=>[o(s(L),{class:"h-full flex flex-col"},{default:r(()=>[e[22]||(e[22]=i("div",{class:"header-section"},[i("div",{class:"header-title"},"商户审核"),i("div",{class:"header-placeholder"})],-1)),i("div",ae,[i("div",le,[o(s(h),{size:16,align:"center",wrap:""},{default:r(()=>[i("div",se,[e[13]||(e[13]=i("span",{class:"filter-label"},"申请编号：",-1)),o(s(v),{value:a.application_no,"onUpdate:value":e[0]||(e[0]=l=>a.application_no=l),placeholder:"请输入申请编号",clearable:"",style:{width:"180px"}},null,8,["value"])]),i("div",ie,[e[14]||(e[14]=i("span",{class:"filter-label"},"店名：",-1)),o(s(v),{value:a.shop_name,"onUpdate:value":e[1]||(e[1]=l=>a.shop_name=l),placeholder:"请输入店名",clearable:"",style:{width:"180px"}},null,8,["value"])]),i("div",oe,[e[15]||(e[15]=i("span",{class:"filter-label"},"状态：",-1)),o(s(O),{value:a.status,"onUpdate:value":e[2]||(e[2]=l=>a.status=l),options:C.value,placeholder:"请选择状态",clearable:"",style:{width:"180px"}},null,8,["value","options"])]),i("div",ne,[e[16]||(e[16]=i("span",{class:"filter-label"},"经营范围：",-1)),o(s(v),{value:a.business_scope,"onUpdate:value":e[3]||(e[3]=l=>a.business_scope=l),placeholder:"请输入经营范围",clearable:"",style:{width:"180px"}},null,8,["value"])]),i("div",re,[e[17]||(e[17]=i("span",{class:"filter-label"},"时间：",-1)),o(s(Y),{value:a.time,"onUpdate:value":e[4]||(e[4]=l=>a.time=l),type:"daterange",placeholder:"请选择时间",clearable:"",style:{width:"400px"}},null,8,["value"])]),i("div",ue,[e[18]||(e[18]=i("span",{class:"filter-label"},"申请人：",-1)),o(s(v),{value:a.applicant_name,"onUpdate:value":e[5]||(e[5]=l=>a.applicant_name=l),placeholder:"请输入申请人",clearable:"",style:{width:"180px"}},null,8,["value"])])]),_:1})]),e[21]||(e[21]=i("div",{class:"filter-divider"},null,-1)),i("div",pe,[o(s(h),{size:12,vertical:""},{default:r(()=>[o(s(N),{type:"primary",class:"filter-btn",loading:g.value,onClick:R},{icon:r(()=>[o(s(S),{icon:"ri:search-line"})]),default:r(()=>[e[19]||(e[19]=_(" 查询 "))]),_:1},8,["loading"]),o(s(N),{class:"reset-btn",onClick:D},{icon:r(()=>[o(s(S),{icon:"ri:refresh-line"})]),default:r(()=>[e[20]||(e[20]=_(" 重置 "))]),_:1})]),_:1})])]),i("div",de,[i("div",ce,[i("div",me,[i("div",fe,[o(s(J),{columns:F.value,data:w.value,pagination:!1,"row-key":l=>l.id,loading:g.value,"checked-row-keys":x.value,"onUpdate:checkedRowKeys":e[6]||(e[6]=l=>x.value=l),striped:""},null,8,["columns","data","row-key","loading","checked-row-keys"])]),i("div",ve,[i("span",ge,"共 "+$(n.itemCount)+" 条",1),o(s(Z),{page:n.page,"onUpdate:page":[e[7]||(e[7]=l=>n.page=l),n.onUpdatePage],"page-size":n.pageSize,"onUpdate:pageSize":[e[8]||(e[8]=l=>n.pageSize=l),n.onUpdatePageSize],"item-count":n.itemCount,"page-sizes":n.pageSizes,"show-size-picker":""},null,8,["page","page-size","item-count","page-sizes","onUpdate:page","onUpdate:pageSize"])])])])])]),_:1})]),_:1}),o(s(E),{show:m.value,"onUpdate:show":e[11]||(e[11]=l=>m.value=l),"show-icon":!1,preset:"dialog",title:"准入审核","positive-text":"确定","negative-text":"取消",onPositiveClick:M,onNegativeClick:e[12]||(e[12]=l=>m.value=!1),style:{width:"600px"},class:"audit-modal"},{default:r(()=>[o(s(ee),{ref_key:"auditFormRef",ref:A,model:u,rules:{result:{required:!0,message:"请选择审核结果",trigger:"change"},audit_comment:{required:u.result===3,message:"请输入驳回原因",trigger:"blur"}},"label-placement":"left","label-width":"100px"},{default:r(()=>[o(s(U),{label:"审核结果",path:"result"},{default:r(()=>[o(s(X),{value:u.result,"onUpdate:value":e[9]||(e[9]=l=>u.result=l)},{default:r(()=>[o(s(h),null,{default:r(()=>[o(s(z),{value:2},{default:r(()=>e[23]||(e[23]=[_("通过")])),_:1}),o(s(z),{value:3},{default:r(()=>e[24]||(e[24]=[_("驳回")])),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),u.result===3?(k(),Q(s(U),{key:0,label:"审核意见",path:"audit_comment"},{default:r(()=>[o(s(v),{value:u.audit_comment,"onUpdate:value":e[10]||(e[10]=l=>u.audit_comment=l),type:"textarea",placeholder:"请输入驳回原因",rows:4,clearable:""},null,8,["value"])]),_:1})):W("",!0)]),_:1},8,["model","rules"])]),_:1},8,["show"])]))}});const Re=G(_e,[["__scopeId","data-v-aa4a5c7a"]]);export{Re as default};
