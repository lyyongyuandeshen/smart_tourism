import{d as Q,bS as k,r as u,a2 as Y,$ as j,o as M,c as P,b as n,ab as r,R as o,w as g,bU as G,a as t,N as m,aS as J,ac as S,ah as N,a5 as z,a6 as v,bW as X,ai as Z,a1 as ee,ad as R,b6 as ae}from"./index-fc2ca07d.js";import{q as te,g as se,a as le,s as ne}from"./merchant-67b4f163.js";import{N as $}from"./Space-29132ab6.js";import{N as oe}from"./DatePicker-f677266b.js";import{N as ie}from"./DataTable-2e69da2a.js";import{N as re}from"./Pagination-078592c4.js";import{N as pe}from"./Form-97fa87e1.js";import{N as h}from"./FormItem-9918da75.js";import"./Forward-86f34074.js";const de={class:"merchant-checkin-container"},ue={class:"filter-section"},ce={class:"filter-content"},me={class:"filter-item"},ve={class:"filter-item"},_e={class:"filter-item"},fe={class:"filter-item"},ge={class:"filter-item"},be={class:"filter-item"},he={class:"filter-actions"},ye={class:"content-section"},we={class:"content-wrapper"},xe={class:"table-container"},ke={class:"table-header"},Se={class:"table-wrapper"},Ne={class:"pagination-wrapper"},ze={class:"total-count"},Ue={key:0,class:"detail-content"},Ce={class:"detail-item"},De={class:"detail-value"},Me={class:"detail-item"},Pe={class:"detail-value"},Re={class:"detail-item"},$e={class:"detail-item"},qe={class:"detail-value"},Ae={class:"detail-item"},Ie={class:"detail-value"},Fe={class:"detail-item"},Ve={class:"detail-value"},Be={class:"detail-item"},Le={class:"detail-value"},Te=Q({__name:"index",setup(Ee){const l=k({application_no:null,shop_name:null,status:null,business_scope:null,time:null,applicant_name:null}),q=u([{label:"全部状态",value:""},{label:"未完成",value:0},{label:"审核中",value:1},{label:"已完成",value:2},{label:"已撤回",value:3}]),c=Y(),_=u(!1),A=()=>{p.page=1,f()},I=()=>{l.application_no=null,l.shop_name=null,l.status=null,l.business_scope=null,l.time=null,l.applicant_name=null,p.page=1,f()},U=u([]),C=u([]),x={0:{label:"未完成",color:"#909399"},1:{label:"审核中",color:"#1890ff"},2:{label:"已完成",color:"#52c41a"},3:{label:"已撤回",color:"#faad14"}},y=u(!1),d=u(null),b=u(!1),D=u(null),w=u(!1),i=k({application_no:"",shop_name:"",applicant_name:"",business_scope:"",service_content:"",status:0}),F={shop_name:[{required:!0,message:"请输入店名",trigger:"blur"},{min:2,max:50,message:"店名长度在 2 到 50 个字符",trigger:"blur"}],applicant_name:[{required:!0,message:"请输入申请人名称",trigger:"blur"},{min:2,max:20,message:"申请人名称长度在 2 到 20 个字符",trigger:"blur"}],business_scope:[{required:!0,message:"请输入经营范围",trigger:"blur"},{min:2,max:200,message:"经营范围长度在 2 到 200 个字符",trigger:"blur"}],service_content:[{max:500,message:"服务内容不能超过 500 个字符",trigger:"blur"}]},V=u((()=>[{type:"selection"},{title:"申请编号",key:"application_no",width:120},{title:"店名",key:"shop_name",width:150},{title:"状态",key:"status",width:120,render:a=>{const e=x[a.status];return g("div",{class:"status-cell",style:"display: inline-flex; align-items: center; gap: 6px;"},[g("span",{class:"status-dot",style:{width:"8px",height:"8px",minWidth:"8px",minHeight:"8px",borderRadius:"50%",display:"inline-block",flexShrink:"0",backgroundColor:e.color}}),g("span",{class:"status-text",style:"font-size: 14px; color: #333;"},e.label)])}},{title:"申请人",key:"applicant_name",width:120},{title:"经营范围",key:"business_scope",width:200},{title:"创建时间",key:"created_time",width:180,render:a=>a.created_time?new Date(a.created_time).toLocaleString("zh-CN"):"-"},{title:"操作",key:"actions",width:150,render:a=>g("div",{class:"action-cell",style:"display: inline-flex; align-items: center; gap: 8px;"},[g("span",{class:"action-link detail",style:{fontSize:"14px",color:"#1890ff",cursor:"pointer"},onClick:()=>B(a)},"详情"),g("span",{class:"action-divider",style:{color:"#d9d9d9"}},"|"),g("span",{class:"action-link withdraw",style:{fontSize:"14px",color:a.status===3?"#ccc":"#ff4d4f",cursor:a.status===3?"not-allowed":"pointer"},onClick:()=>{a.status!==3&&L(a)}},"撤回")])}])()),p=k({page:1,pageSize:10,itemCount:0,pageSizes:[10,20,30,50],showSizePicker:!0,onUpdatePage:a=>{p.page=a,f()},onUpdatePageSize:a=>{p.pageSize=a,p.page=1,f()}}),f=async()=>{try{_.value=!0;const a={page:p.page,page_size:p.pageSize};l.application_no&&(a.application_no=l.application_no),l.shop_name&&(a.shop_name=l.shop_name),l.status!==null&&l.status!==""&&(a.status=l.status),l.business_scope&&(a.business_scope=l.business_scope),l.applicant_name&&(a.applicant_name=l.applicant_name),l.time&&l.time.length===2&&(a.start_date=new Date(l.time[0]).toISOString().split("T")[0],a.end_date=new Date(l.time[1]).toISOString().split("T")[0]);const e=await te(a);console.log("商户入住列表返回:",e),e.success?(U.value=e.data,p.itemCount=e.total):c.error(e.message||"获取数据失败")}catch(a){console.error("获取商户申请列表失败:",a),c.error(a.message||"获取数据失败")}finally{_.value=!1}},B=async a=>{try{const e=await se(a.application_no);console.log("详情返回:",e),d.value=e,y.value=!0}catch(e){console.error("获取详情失败:",e),c.error(e.message||"获取详情失败")}},L=async a=>{try{const e=await le({application_no:a.application_no,status:3,audit_comment:""});console.log("撤回返回:",e),e.success?(c.success("撤回成功"),f()):c.error("撤回失败")}catch(e){console.error("撤回失败:",e),c.error("撤回失败")}},T=()=>{const a=new Date,e=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),K=String(a.getDate()).padStart(2,"0"),H=Math.floor(Math.random()*1e4).toString().padStart(4,"0");return`MER${e}${s}${K}${H}`},E=()=>{w.value=!1,i.application_no=T(),i.shop_name="",i.applicant_name="",i.business_scope="",i.service_content="",i.status=1,b.value=!0},O=async()=>{try{_.value=!0;const a=await ne(i);console.log("提交返回:",a),a.success?(c.success(w.value?"更新成功":"申请提交成功"),b.value=!1,f()):c.error(a.message||"提交失败")}catch(a){a!=null&&a.message?console.error("表单验证失败:",a):(console.error("提交失败:",a),c.error(a.message||"提交失败"))}finally{_.value=!1}},W=()=>{var a;b.value=!1,(a=D.value)==null||a.restoreValidation()};return j(()=>{f()}),(a,e)=>(M(),P("div",de,[n(o(X),{"has-sider":"",class:"h-full w-full"},{default:r(()=>[n(o(G),{class:"h-full flex flex-col"},{default:r(()=>[e[27]||(e[27]=t("div",{class:"header-section"},[t("div",{class:"header-title"},"商户入住"),t("div",{class:"header-placeholder"})],-1)),t("div",ue,[t("div",ce,[n(o($),{size:16,align:"center",wrap:""},{default:r(()=>[t("div",me,[e[17]||(e[17]=t("span",{class:"filter-label"},"申请编号：",-1)),n(o(m),{value:l.application_no,"onUpdate:value":e[0]||(e[0]=s=>l.application_no=s),placeholder:"请输入申请编号",clearable:"",style:{width:"180px"}},null,8,["value"])]),t("div",ve,[e[18]||(e[18]=t("span",{class:"filter-label"},"店名：",-1)),n(o(m),{value:l.shop_name,"onUpdate:value":e[1]||(e[1]=s=>l.shop_name=s),placeholder:"请输入店名",clearable:"",style:{width:"180px"}},null,8,["value"])]),t("div",_e,[e[19]||(e[19]=t("span",{class:"filter-label"},"状态：",-1)),n(o(J),{value:l.status,"onUpdate:value":e[2]||(e[2]=s=>l.status=s),options:q.value,placeholder:"请选择状态",clearable:"",style:{width:"180px"}},null,8,["value","options"])]),t("div",fe,[e[20]||(e[20]=t("span",{class:"filter-label"},"经营范围：",-1)),n(o(m),{value:l.business_scope,"onUpdate:value":e[3]||(e[3]=s=>l.business_scope=s),placeholder:"请输入经营范围",clearable:"",style:{width:"180px"}},null,8,["value"])]),t("div",ge,[e[21]||(e[21]=t("span",{class:"filter-label"},"时间：",-1)),n(o(oe),{value:l.time,"onUpdate:value":e[4]||(e[4]=s=>l.time=s),type:"daterange",placeholder:"请选择时间",clearable:"",style:{width:"400px"}},null,8,["value"])]),t("div",be,[e[22]||(e[22]=t("span",{class:"filter-label"},"申请人：",-1)),n(o(m),{value:l.applicant_name,"onUpdate:value":e[5]||(e[5]=s=>l.applicant_name=s),placeholder:"请输入申请人",clearable:"",style:{width:"180px"}},null,8,["value"])])]),_:1})]),e[25]||(e[25]=t("div",{class:"filter-divider"},null,-1)),t("div",he,[n(o($),{size:12,vertical:""},{default:r(()=>[n(o(S),{type:"primary",class:"filter-btn",loading:_.value,onClick:A},{icon:r(()=>[n(o(N),{icon:"ri:search-line"})]),default:r(()=>[e[23]||(e[23]=z(" 查询 "))]),_:1},8,["loading"]),n(o(S),{class:"reset-btn",onClick:I},{icon:r(()=>[n(o(N),{icon:"ri:refresh-line"})]),default:r(()=>[e[24]||(e[24]=z(" 重置 "))]),_:1})]),_:1})])]),t("div",ye,[t("div",we,[t("div",xe,[t("div",ke,[n(o(S),{type:"primary",class:"add-btn",onClick:E},{icon:r(()=>[n(o(N),{icon:"ri:add-line"})]),default:r(()=>[e[26]||(e[26]=z(" 商户入住 "))]),_:1})]),t("div",Se,[n(o(ie),{columns:V.value,data:U.value,pagination:!1,"row-key":s=>s.id,loading:_.value,"checked-row-keys":C.value,"onUpdate:checkedRowKeys":e[6]||(e[6]=s=>C.value=s),striped:""},null,8,["columns","data","row-key","loading","checked-row-keys"])]),t("div",Ne,[t("span",ze,"共 "+v(p.itemCount)+" 条",1),n(o(re),{page:p.page,"onUpdate:page":[e[7]||(e[7]=s=>p.page=s),p.onUpdatePage],"page-size":p.pageSize,"onUpdate:pageSize":[e[8]||(e[8]=s=>p.pageSize=s),p.onUpdatePageSize],"item-count":p.itemCount,"page-sizes":p.pageSizes,"show-size-picker":""},null,8,["page","page-size","item-count","page-sizes","onUpdate:page","onUpdate:pageSize"])])])])])]),_:1})]),_:1}),n(o(R),{show:y.value,"onUpdate:show":e[9]||(e[9]=s=>y.value=s),"show-icon":!1,preset:"dialog",title:"商户入住详情","positive-text":"关闭",onPositiveClick:e[10]||(e[10]=s=>y.value=!1),style:{width:"600px"},class:"detail-modal"},{default:r(()=>[d.value?(M(),P("div",Ue,[t("div",Ce,[e[28]||(e[28]=t("span",{class:"detail-label"},"申请编号：",-1)),t("span",De,v(d.value.application_no),1)]),t("div",Me,[e[29]||(e[29]=t("span",{class:"detail-label"},"店名：",-1)),t("span",Pe,v(d.value.shop_name),1)]),t("div",Re,[e[30]||(e[30]=t("span",{class:"detail-label"},"状态：",-1)),t("span",{class:"detail-value",style:Z({color:x[d.value.status].color})},v(x[d.value.status].label),5)]),t("div",$e,[e[31]||(e[31]=t("span",{class:"detail-label"},"申请人：",-1)),t("span",qe,v(d.value.applicant_name),1)]),t("div",Ae,[e[32]||(e[32]=t("span",{class:"detail-label"},"经营范围：",-1)),t("span",Ie,v(d.value.business_scope),1)]),t("div",Fe,[e[33]||(e[33]=t("span",{class:"detail-label"},"服务内容：",-1)),t("span",Ve,v(d.value.service_content||"-"),1)]),t("div",Be,[e[34]||(e[34]=t("span",{class:"detail-label"},"创建时间：",-1)),t("span",Le,v(d.value.created_time?new Date(d.value.created_time).toLocaleString("zh-CN"):"-"),1)])])):ee("",!0)]),_:1},8,["show"]),n(o(R),{show:b.value,"onUpdate:show":e[16]||(e[16]=s=>b.value=s),"show-icon":!1,preset:"dialog",title:w.value?"编辑商户申请":"新增商户申请","positive-text":w.value?"更新":"提交","negative-text":"取消",loading:_.value,onPositiveClick:O,onNegativeClick:W,style:{width:"600px"},class:"form-modal"},{default:r(()=>[n(o(pe),{ref_key:"formRef",ref:D,model:i,rules:F,"label-placement":"left","label-width":"100px","require-mark-placement":"left"},{default:r(()=>[n(o(h),{label:"申请编号",path:"application_no"},{default:r(()=>[n(o(m),{value:i.application_no,"onUpdate:value":e[11]||(e[11]=s=>i.application_no=s),disabled:"",placeholder:"系统自动生成"},null,8,["value"])]),_:1}),n(o(h),{label:"店名",path:"shop_name"},{default:r(()=>[n(o(m),{value:i.shop_name,"onUpdate:value":e[12]||(e[12]=s=>i.shop_name=s),placeholder:"请输入店名",maxlength:"50","show-count":"",clearable:""},null,8,["value"])]),_:1}),n(o(h),{label:"申请人名称",path:"applicant_name"},{default:r(()=>[n(o(m),{value:i.applicant_name,"onUpdate:value":e[13]||(e[13]=s=>i.applicant_name=s),placeholder:"请输入申请人名称",maxlength:"20","show-count":"",clearable:""},null,8,["value"])]),_:1}),n(o(h),{label:"经营范围",path:"business_scope"},{default:r(()=>[n(o(m),{value:i.business_scope,"onUpdate:value":e[14]||(e[14]=s=>i.business_scope=s),type:"textarea",placeholder:"请输入经营范围，例如：餐饮、住宿、娱乐等",rows:3,maxlength:"200","show-count":"",clearable:""},null,8,["value"])]),_:1}),n(o(h),{label:"服务内容",path:"service_content"},{default:r(()=>[n(o(m),{value:i.service_content,"onUpdate:value":e[15]||(e[15]=s=>i.service_content=s),type:"textarea",placeholder:"请输入服务内容（可选）",rows:4,maxlength:"500","show-count":"",clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","positive-text","loading"])]))}});const Ze=ae(Te,[["__scopeId","data-v-d767d50a"]]);export{Ze as default};
