import{d as $,o as d,c as g,a as t,X as U,aa as F,a6 as C,Q as k,a8 as _,R as n,N as j,aS as O,a1 as q,b as i,ab as v,ah as A,a5 as x,b6 as L,r as h,bX as Q,ad as G,bR as H,bS as J,n as D,w as K}from"./index-fc2ca07d.js";import{M as f,P as W}from"./index-4734ee68.js";import{N as Y}from"./DatePicker-f677266b.js";import{N as Z}from"./DataTable-2e69da2a.js";import"./Pagination-078592c4.js";import"./Forward-86f34074.js";const ee={class:"flex items-start"},ae={class:"text-sm text-[#4E5969] whitespace-nowrap"},le={class:"w-[6.875rem] pl-5 flex flex-col gap-5 border-l border-[#E5E6EB]"},te={class:"flex items-center gap-2"},ne={class:"flex items-center gap-2"},se=$({__name:"index",props:{fields:{},cols:{},modelValue:{}},emits:["update:modelValue","search","reset"],setup(X,{emit:y}){const p=y,m=()=>{p("search")},u=()=>{p("reset")};return(c,s)=>(d(),g("div",ee,[t("div",{class:_(["flex flex-1 grid",`grid-cols-${c.cols||3} gap-4 pr-5`])},[(d(!0),g(U,null,F(c.fields,e=>(d(),g("div",{key:e.name,class:"flex items-center gap-4"},[t("label",ae,C(e.label),1),e.type==="input"?(d(),k(n(j),{key:0,value:c.modelValue[e.name],"onUpdate:value":o=>c.modelValue[e.name]=o,placeholder:e.placeholder,class:_(e.class)},null,8,["value","onUpdate:value","placeholder","class"])):e.type==="select"?(d(),k(n(O),{key:1,value:c.modelValue[e.name],"onUpdate:value":o=>c.modelValue[e.name]=o,options:e.options,placeholder:e.placeholder,class:_(e.class)},null,8,["value","onUpdate:value","options","placeholder","class"])):e.type==="date"?(d(),k(n(Y),{key:2,value:c.modelValue[e.name],"onUpdate:value":o=>c.modelValue[e.name]=o,type:"date",placeholder:e.placeholder,class:_(`flex-1 ${e.class||""}`)},null,8,["value","onUpdate:value","placeholder","class"])):q("",!0)]))),128))],2),t("div",le,[i(n(f),{type:"primary",onClick:m},{default:v(()=>[t("div",te,[i(n(A),{icon:"ri:search-2-line"}),s[0]||(s[0]=x(" 查询 "))])]),_:1}),i(n(f),{reset:"",onClick:u},{default:v(()=>[t("div",ne,[i(n(A),{icon:"ri:refresh-line"}),s[1]||(s[1]=x(" 重置 "))])]),_:1})])]))}}),oe=L(se,[["__scopeId","data-v-2b007124"]]),re={class:"flex items-center"},ce={class:"flex items-center"},ie={class:"flex justify-center items-center"},ue={class:"flex justify-end gap-2 p-4"},de=$({__name:"AdjustSharingModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirm"],setup(X,{emit:y}){const p=y,m=h([{id:1,channel:"渠道1",ratio:6},{id:2,channel:"渠道2",ratio:5},{id:3,channel:"渠道3",ratio:4}]),u=()=>{p("update:modelValue",!1)},c=()=>{p("confirm",m.value.map(s=>({channel:s.channel,ratio:s.ratio}))),u()};return(s,e)=>(d(),k(n(G),{show:s.modelValue,"onUpdate:show":e[0]||(e[0]=o=>p("update:modelValue",o)),title:"调整分账规则",preset:"card",style:{width:"800px"}},{footer:v(()=>[t("div",ue,[i(n(f),{onClick:u},{default:v(()=>e[3]||(e[3]=[x("取消")])),_:1}),i(n(f),{type:"primary",onClick:c},{default:v(()=>e[4]||(e[4]=[x("确定")])),_:1})])]),default:v(()=>[t("div",null,[e[2]||(e[2]=t("div",{class:"grid grid-cols-3 gap-4 p-4 bg-gray-50"},[t("div",{class:"font-medium"},"序号"),t("div",{class:"font-medium"},"渠道"),t("div",{class:"font-medium text-center"},"分配比例")],-1)),(d(!0),g(U,null,F(m.value,(o,S)=>(d(),g("div",{key:S,class:"grid grid-cols-3 gap-4 px-4 py-2 border-b border-gray-100"},[t("div",re,C(o.id),1),t("div",ce,C(o.channel),1),t("div",ie,[i(n(Q),{value:o.ratio,"onUpdate:value":b=>o.ratio=b,min:0,max:100,placeholder:"请输入比例",class:"w-28"},null,8,["value","onUpdate:value"]),e[1]||(e[1]=t("span",{class:"ml-2"},"%",-1))])]))),128))])]),_:1},8,["show"]))}}),pe={class:"p-6 h-full bg-white"},me={class:"px-2 mb-5"},he={class:"mb-5 flex gap-2"},ve={class:"rounded-lg overflow-hidden"},ke=$({__name:"index",setup(X){const y=H(),p=[{label:"全部",value:""},{label:"XXX景点",value:"1"}],m=[{label:"全部",value:""},{label:"渠道1",value:"channel1"},{label:"渠道2",value:"channel2"},{label:"渠道3",value:"channel3"}],u=h(1),c=h(50),s=h(10),e=J({productName:"",scenicName:null,channel:null,orderDate:null}),o=[{label:"商品名称",name:"productName",type:"input",placeholder:"请输入商品名称"},{label:"景点名称",name:"scenicName",type:"select",placeholder:"请选择景点",options:p},{label:"渠道",name:"channel",type:"select",placeholder:"全部",options:m},{label:"下单时间",name:"orderDate",type:"date",placeholder:"请选择日期"}],S=h(Array(10).fill(0).map((a,l)=>{const r=l%3,N=l%3+1;return{id:l+1,orderNo:`SN20241018XX${String(l+1).padStart(3,"0")}`,productName:"XXX景点门票",quantity:N,totalAmount:N===1?50:N===2?100:150,sharingAmount:N===1?3:N===2?5:6,scenicName:"XXX景点",channel:r===0?"渠道1":r===1?"渠道2":"渠道3",orderTime:"2025-03-10 12:54:21"}})),b=D(()=>S.value.filter(a=>{if(e.productName&&!a.productName.includes(e.productName))return!1;if(e.scenicName&&e.scenicName!==""){const l=p.find(r=>r.value===e.scenicName);if(l&&a.scenicName!==l.label)return!1}if(e.channel&&e.channel!==""){const l=m.find(r=>r.value===e.channel);if(l&&a.channel!==l.label)return!1}return!0})),B=D(()=>{const a=(u.value-1)*s.value,l=a+s.value;return b.value.slice(a,l)}),T=()=>{e.productName="",e.scenicName=null,e.channel=null,e.orderDate=null,u.value=1},w=()=>{u.value=1,M()},M=()=>{c.value=b.value.length},R=a=>{console.log("分账结算:",a),y.push({name:"FinanceSettlement",params:{orderId:a.id},query:{orderNo:a.orderNo,scenicName:a.scenicName,channel:a.channel,orderTime:a.orderTime,totalAmount:a.totalAmount,sharingAmount:a.sharingAmount,productName:a.productName}})},z=()=>{console.log("生成票务销售报表")},V=h(!1),E=()=>{V.value=!0},I=[{title:"订单号",key:"orderNo"},{title:"商品名称",key:"productName"},{title:"数量",key:"quantity",align:"center"},{title:"总计(元)",key:"totalAmount",align:"center",render:a=>`${a.totalAmount.toFixed(2)}`},{title:"分账金额(元)",key:"sharingAmount",align:"center"},{title:"景点名称",key:"scenicName"},{title:"渠道",key:"channel"},{title:"下单时间",key:"orderTime"},{title:"操作",key:"action",align:"center",render:a=>K("button",{class:"text-[#165DFF]",onClick:()=>R(a)},"分账结算")}],P=a=>{console.log("确认分账规则:",a)};return(a,l)=>(d(),g(U,null,[t("div",pe,[l[4]||(l[4]=t("h2",{class:"text-[#1D2129] mb-6"},"票务对账",-1)),t("div",me,[i(n(oe),{fields:o,cols:3,modelValue:e,"onUpdate:modelValue":l[0]||(l[0]=r=>e=r),onSearch:w,onReset:T},null,8,["modelValue"])]),t("div",he,[i(n(f),{type:"primary",text:"生成票务销售报表",onClick:z}),i(n(f),{text:"调整自动分账比例",onClick:E})]),t("div",ve,[i(n(Z),{columns:I,data:B.value,bordered:!1,class:"w-full",pagination:!1},null,8,["data"])]),i(n(W),{"total-count":c.value,"current-page":u.value,"onUpdate:currentPage":l[1]||(l[1]=r=>u.value=r),"page-size":s.value,"onUpdate:pageSize":l[2]||(l[2]=r=>s.value=r)},null,8,["total-count","current-page","page-size"])]),i(de,{modelValue:V.value,"onUpdate:modelValue":l[3]||(l[3]=r=>V.value=r),onConfirm:P},null,8,["modelValue"])],64))}});export{ke as default};
