var w=Object.defineProperty;var S=(t,e,a)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var f=(t,e,a)=>(S(t,typeof e!="symbol"?e+"":e,a),a);import{G as p,m as u,h as o,I as m,H as b}from"./index-9ac666b4.js";class k{constructor(){f(this,"localKey","suno-store")}save(e){if(!e.id)throw"id must";let a=this.getObjs(),s=a.findIndex(l=>l.id==e.id);return s>-1?a[s]=e:a.push(e),p.set(this.localKey,a),this}findIndex(e){return this.getObjs().findIndex(a=>a.id==e)}getObjs(){const e=p.get(this.localKey);return e||[]}}const D=t=>t.indexOf("http")==0?t:m.myData.SUNO_SERVER?m.myData.SUNO_SERVER.indexOf("suno")>0?`${m.myData.SUNO_SERVER}${t}`:`${m.myData.SUNO_SERVER}/suno${t}`:`/api/sunoapi${t}`;function O(){let t={},e={Authorization:"Bearer "+b()};return t={...t,...e},console.log("headers======",t),t}function g(t){return new Promise(e=>setTimeout(e,t))}const R=async t=>{for(let e=0;e<50;e++){let a=await y(`/lyrics/${t}`);u("ddd",a);let s=e+1;if(s>20&&(s=20),a.data.progress=="100%")return a;await g(s*1e3)}return null};function j(){const t=["acoustic","aggressive","anthemic","atmospheric","bouncy","chill","dark","dreamy","electronic","emotional","epic","experimental","futuristic","groovy","heartfelt","infectious","melodic","mellow","powerful","psychedelic","romantic","smooth","syncopated","uplifting",""],e=["afrobeat","anime","ballad","bedroom pop","bluegrass","blues","classical","country","cumbia","dance","dancepop","delta blues","electropop","disco","dream pop","drum and bass","edm","emo","folk","funk","future bass","gospel","grunge","grime","hip hop","house","indie","j-pop","jazz","k-pop","kids music","metal","new jack swing","new wave","opera","pop","punk","raga","rap","reggae","reggaeton","rock","rumba","salsa","samba","sertanejo","soul","synthpop","swing","synthwave","techno","trap","uk garage"],a=t[Math.floor(Math.random()*t.length)],s=e[Math.floor(Math.random()*e.length)];return a+" "+s}const E=async t=>{const e=new k;if(t.length<=0)return;let a=await y("/feed/"+t.join(","));u("FeedTask",a),console.log("FeedTask",a),a.forEach(s=>{e.save(s),(s.status=="complete"||s.status=="error")&&(t=t.filter(l=>l!=s.id))}),o.setMyData({act:"FeedTask"}),await g(5*1e3),E(t)},y=(t,e,a)=>{u("sunoFetch",t);let s={"Content-Type":"application/json"};return a&&a.headers&&(s=a.headers),s={...s,...O()},new Promise((l,h)=>{let i={method:"GET"};i.headers=s,a!=null&&a.upFile?(i.method="POST",i.body=e):e&&(i.body=JSON.stringify(e),i.method="POST"),fetch(D(t),i).then(async r=>{var d;if(!r.ok){let n="发生错误: "+r.status;try{let c=await r.json();n="("+r.status+")发生错误: "+(((d=c==null?void 0:c.error)==null?void 0:d.message)??"")}catch{}throw o.myData.ms&&o.myData.ms.error(n),new Error(n)}r.json().then(n=>l(n)).catch(n=>{o.myData.ms&&o.myData.ms.error("发生错误"+n),h(n)})}).catch(r=>{r.name==="TypeError"&&r.message==="Failed to fetch"?o.myData.ms&&o.myData.ms.error("跨域|CORS error"):o.myData.ms&&o.myData.ms.error("发生错误:"+r),u("e",r.stat),h(r)})})};export{E as F,y as a,k as b,R as l,j as r,g as s};
