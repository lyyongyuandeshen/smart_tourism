var R=Object.defineProperty;var U=(o,e,t)=>e in o?R(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var L=(o,e,t)=>(U(o,typeof e!="symbol"?e+"":e,t),t);import{G as M,h as d,m as k,H as V,I as N,J as G,d as D,r as y,E as H,l as J,c as E,o as c,b as v,g as l,e as f,a as m,K as Y,v as h,w,L as q,M as z,t as B,O as A,P as O,Q,j as W,F as X,q as Z,R as ee,S as te,x as se,T as oe}from"./index-9ac666b4.js";import{s as ae}from"./suno-6eb4964a.js";class K{constructor(){L(this,"localKey","luma-store")}save(e){if(!e.id)throw"id must";let t=this.getObjs(),n=t.findIndex(i=>i.id==e.id);return n>-1?t[n]=e:t.push(e),M.set(this.localKey,t),this}findIndex(e){return this.getObjs().findIndex(t=>t.id==e)}getObjs(){const e=M.get(this.localKey);return e||[]}}function re(){let o={};if(d.myData.vtoken){const t={"x-vtoken":d.myData.vtoken,"x-ctoken":d.myData.ctoken};o={...o,...t}}if(!N.myData.LUMA_KEY){const t=G();if(t.token){const n={"x-ptoken":t.token};return o={...o,...n},o}return o}const e={Authorization:"Bearer "+N.myData.LUMA_KEY};return o={...o,...e},o}const ne=o=>o.indexOf("http")==0?o:`/api/luma${o}`,P=(o,e,t)=>{k("sunoFetch",o);let n={"Content-Type":"application/json",Authorization:"Bearer "+V()};return t&&t.headers&&(n=t.headers),n={...n,...re()},new Promise((i,u)=>{let p={method:"GET"};p.headers=n,t!=null&&t.upFile?(p.method="POST",p.body=e):e&&(p.body=JSON.stringify(e),p.method="POST"),fetch(ne(o),p).then(async s=>{var _;if(!s.ok){let a="发生错误: "+s.status;try{let r=await s.json();a="("+s.status+")发生错误: "+(((_=r==null?void 0:r.error)==null?void 0:_.message)??"")}catch{}throw d.myData.ms&&d.myData.ms.error(a),new Error(a)}s.json().then(a=>i(a)).catch(a=>{d.myData.ms&&d.myData.ms.error("发生错误"+a),u(a)})}).catch(s=>{s.name==="TypeError"&&s.message==="Failed to fetch"?d.myData.ms&&d.myData.ms.error("跨域|CORS error"):d.myData.ms&&d.myData.ms.error("发生错误:"+s),k("e",s.stat),u(s)})})},x=async o=>{var t;if(o=="")return"";const e=new K;for(let n=0;n<120;n++){let i=await P("/generations/"+o);if(i.id&&(i.last_feed=new Date().getTime(),e.save(i),d.setMyData({act:"FeedLumaTask"}),i.state=="completed"&&i.video&&((t=i.video)!=null&&t.download_url)))break;await ae(5*1e3)}},le={class:"p-2"},ie={class:"pt-1"},de={class:"flex justify-between items-end"},ue=["src"],ce={key:1,class:"text-center"},ve={class:"pb-1 text-right"},pe=D({__name:"voInput",setup(o){const e=y({aspect_ratio:"16:9",expand_prompt:!0,image_url:"",user_prompt:""}),t=y({isDo:!1}),n=H(),i=y();J(()=>{d.setMyData({ms:n})});const u=E(()=>e.value.user_prompt!=""&&!t.value.isDo),p=async()=>{if(k("generate",e.value),t.value.isDo=!0,!u){n.error(O("video.plsInput"));return}try{const a=await P("/generations/",e.value);k("d",a),a.id?x(a.id):x(a[0].id),n.success(O("video.submitSuccess"))}catch{}t.value.isDo=!1};function s(a){Q(a.target.files[0]).then(r=>{e.value.image_url=r,i.value=""}).catch(r=>n.error(r))}const _=()=>{e.value.user_prompt="",e.value.image_url=""};return(a,r)=>(c(),v("div",le,[l("div",null,[f(m(Y),{value:e.value.user_prompt,"onUpdate:value":r[0]||(r[0]=g=>e.value.user_prompt=g),placeholder:a.$t("video.descpls"),type:"textarea",size:"small",autosize:{minRows:3,maxRows:12}},null,8,["value","placeholder"])]),l("div",ie,[l("div",de,[l("div",null,[l("input",{type:"file",onChange:s,ref_key:"fsRef",ref:i,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),l("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer upload-video",onClick:r[1]||(r[1]=g=>i.value.click())},[e.value.image_url?(c(),v("img",{key:0,src:e.value.image_url},null,8,ue)):(c(),v("div",ce,h(a.$t("video.selectimg")),1))])]),l("div",ve,[f(m(q),{type:"info",size:"small",round:""},{default:w(()=>[l("span",{class:"cursor-pointer",onClick:r[2]||(r[2]=g=>_())},h(a.$t("video.clear")),1)]),_:1})])]),l("div",null,[l("div",null,[f(m(A),{loading:t.value.isDo,style:{"border-radius":"10px"},class:"genner-button",bordered:!1,type:"success",disabled:!u.value,onClick:r[3]||(r[3]=g=>p())},{default:w(()=>[f(m(z),{icon:"ri:video-add-line"}),B(" "+h(a.$t("video.generate")),1)]),_:1},8,["loading","disabled"])])])])]))}}),me={key:0,class:"p-4"},fe={class:"grid grid-cols-1 gap-5 md:grid-cols-2 lg:grid-cols-3"},_e=["onMousemove"],he={class:"relative flex items-center justify-center bg-white bg-opacity-10 rounded-[16px] overflow-hidden aspect-[16/8.85]"},ge=["src","controls"],ye={key:1,class:"text-center"},we={key:1,class:"pt-2"},ke={class:"flex justify-between items-center"},xe={class:"line-clamp-1"},De={class:"max-w-[300px]"},$e=["href"],be={key:1,class:"w-full h-full flex justify-center items-center"},Se=D({__name:"voList",setup(o){const e=y({pIndex:-1}),t=y([]),n=new K,i=()=>{let u=n.getObjs();t.value=u.reverse()};return E(()=>new Date().getTime()),W(()=>d.myData.act,u=>{u=="FeedLumaTask"&&i()}),i(),(u,p)=>t.value.length>0?(c(),v("div",me,[l("div",fe,[(c(!0),v(X,null,Z(t.value,(s,_)=>{var a,r,g,$,b,S,T,I,j,C;return c(),v("div",{key:_,class:"relative",onMousemove:F=>e.value.pIndex=_,onMouseout:p[0]||(p[0]=F=>e.value.pIndex=-1)},[l("div",he,[(a=s.video)!=null&&a.url||(r=s.video)!=null&&r.download_url?(c(),v("video",{key:0,src:(g=s.video)!=null&&g.download_url?($=s.video)==null?void 0:$.download_url:(b=s.video)==null?void 0:b.url,loop:"",playsinline:"",controls:e.value.pIndex==_,class:"w-full h-full object-cover"},null,8,ge)):(c(),v("div",ye,[!s.last_feed||new Date().getTime()-s.last_feed>20*1e3?(c(),ee(m(A),{key:0,size:"small",type:"primary",onClick:F=>m(x)(s.id)},{default:w(()=>[B(h(u.$t("video.repeat")),1)]),_:2},1032,["onClick"])):(c(),v("div",we,h(u.$t("video.process"))+h(new Date(s.last_feed).toLocaleString()),1))]))]),l("div",ke,[l("div",null,[f(m(te),{trigger:"hover"},{trigger:w(()=>[l("div",xe,h(s.prompt),1)]),default:w(()=>[l("div",De,h(s.prompt),1)]),_:2},1024)]),l("div",null,[(S=s.video)!=null&&S.url||(T=s.video)!=null&&T.download_url?(c(),v("a",{key:0,href:(I=s.video)!=null&&I.download_url?(j=s.video)==null?void 0:j.download_url:(C=s.video)==null?void 0:C.url,download:"",target:"_blank"},[f(m(z),{icon:"mdi:download",class:"cursor-pointer"})],8,$e)):se("",!0)])])],40,_e)}),128))])])):(c(),v("div",be,[f(m(oe),{description:u.$t("video.nodata")},null,8,["description"])]))}}),Te={class:"flex w-full h-full video-content"},Ie={class:"w-[300px] h-full overflow-y-auto vo-input"},je={class:"flex-1 h-full bg-[#fafbfc] pt-2 dark:bg-[#18181c] overflow-y-auto video-list"},Me=D({__name:"video",setup(o){return(e,t)=>(c(),v("div",Te,[l("div",Ie,[f(pe)]),l("div",je,[f(Se)])]))}});export{Me as default};
