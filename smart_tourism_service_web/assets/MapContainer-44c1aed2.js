import{bh as G,bi as J,d as N,r as R,j,l as F,n as T,o as V,b as Z,g as q,D as H}from"./index-1b86b595.js";var W={exports:{}};(function(x,P){(function(h,d){x.exports=d()})(G,function(){function h(e){var p=[];return e.AMapUI&&p.push(d(e.AMapUI)),e.Loca&&p.push(I(e.Loca)),Promise.all(p)}function d(e){return new Promise(function(p,a){var r=[];if(e.plugins)for(var i=0;i<e.plugins.length;i+=1)n.AMapUI.plugins.indexOf(e.plugins[i])==-1&&r.push(e.plugins[i]);if(u.AMapUI===t.failed)a("前次请求 AMapUI 失败");else if(u.AMapUI===t.notload){u.AMapUI=t.loading,n.AMapUI.version=e.version||n.AMapUI.version,i=n.AMapUI.version;var o=document.body||document.head,g=document.createElement("script");g.type="text/javascript",g.src="https://webapi.amap.com/ui/"+i+"/main.js",g.onerror=function(c){u.AMapUI=t.failed,a("请求 AMapUI 失败")},g.onload=function(){if(u.AMapUI=t.loaded,r.length)window.AMapUI.loadUI(r,function(){for(var c=0,w=r.length;c<w;c++){var L=r[c].split("/").slice(-1)[0];window.AMapUI[L]=arguments[c]}for(p();M.AMapUI.length;)M.AMapUI.splice(0,1)[0]()});else for(p();M.AMapUI.length;)M.AMapUI.splice(0,1)[0]()},o.appendChild(g)}else u.AMapUI===t.loaded?e.version&&e.version!==n.AMapUI.version?a("不允许多个版本 AMapUI 混用"):r.length?window.AMapUI.loadUI(r,function(){for(var c=0,w=r.length;c<w;c++){var L=r[c].split("/").slice(-1)[0];window.AMapUI[L]=arguments[c]}p()}):p():e.version&&e.version!==n.AMapUI.version?a("不允许多个版本 AMapUI 混用"):M.AMapUI.push(function(c){c?a(c):r.length?window.AMapUI.loadUI(r,function(){for(var w=0,L=r.length;w<L;w++){var C=r[w].split("/").slice(-1)[0];window.AMapUI[C]=arguments[w]}p()}):p()})})}function I(e){return new Promise(function(p,a){if(u.Loca===t.failed)a("前次请求 Loca 失败");else if(u.Loca===t.notload){u.Loca=t.loading,n.Loca.version=e.version||n.Loca.version;var r=n.Loca.version,i=n.AMap.version.startsWith("2"),o=r.startsWith("2");if(i&&!o||!i&&o)a("JSAPI 与 Loca 版本不对应！！");else{i=n.key,o=document.body||document.head;var g=document.createElement("script");g.type="text/javascript",g.src="https://webapi.amap.com/loca?v="+r+"&key="+i,g.onerror=function(c){u.Loca=t.failed,a("请求 AMapUI 失败")},g.onload=function(){for(u.Loca=t.loaded,p();M.Loca.length;)M.Loca.splice(0,1)[0]()},o.appendChild(g)}}else u.Loca===t.loaded?e.version&&e.version!==n.Loca.version?a("不允许多个版本 Loca 混用"):p():e.version&&e.version!==n.Loca.version?a("不允许多个版本 Loca 混用"):M.Loca.push(function(c){c?a(c):a()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var t;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(t||(t={}));var n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:t.notload,AMapUI:t.notload,Loca:t.notload},M={AMap:[],AMapUI:[],Loca:[]},b=[],y=function(e){typeof e=="function"&&(u.AMap===t.loaded?e(window.AMap):b.push(e))};return{load:function(e){return new Promise(function(p,a){if(u.AMap==t.failed)a("");else if(u.AMap==t.notload){var r=e.key,i=e.version,o=e.plugins;r?(window.AMap&&location.host!=="lbs.amap.com"&&a("禁止多种API加载方式混用"),n.key=r,n.AMap.version=i||n.AMap.version,n.AMap.plugins=o||n.AMap.plugins,u.AMap=t.loading,i=document.body||document.head,window.___onAPILoaded=function(c){if(delete window.___onAPILoaded,c)u.AMap=t.failed,a(c);else for(u.AMap=t.loaded,h(e).then(function(){p(window.AMap)}).catch(a);b.length;)b.splice(0,1)[0]()},o=document.createElement("script"),o.type="text/javascript",o.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+n.AMap.version+"&key="+r+"&plugin="+n.AMap.plugins.join(","),o.onerror=function(c){u.AMap=t.failed,a(c)},i.appendChild(o)):a("请填写key")}else if(u.AMap==t.loaded)if(e.key&&e.key!==n.key)a("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)a("不允许多个版本 JSAPI 混用");else{if(r=[],e.plugins)for(i=0;i<e.plugins.length;i+=1)n.AMap.plugins.indexOf(e.plugins[i])==-1&&r.push(e.plugins[i]);r.length?window.AMap.plugin(r,function(){h(e).then(function(){p(window.AMap)}).catch(a)}):h(e).then(function(){p(window.AMap)}).catch(a)}else if(e.key&&e.key!==n.key)a("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)a("不允许多个版本 JSAPI 混用");else{var g=[];if(e.plugins)for(i=0;i<e.plugins.length;i+=1)n.AMap.plugins.indexOf(e.plugins[i])==-1&&g.push(e.plugins[i]);y(function(){g.length?window.AMap.plugin(g,function(){h(e).then(function(){p(window.AMap)}).catch(a)}):h(e).then(function(){p(window.AMap)}).catch(a)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:t.notload,AMapUI:t.notload,Loca:t.notload},M={AMap:[],AMapUI:[],Loca:[]}}}})})(W);var $=W.exports;const K=J($),Q={class:"map-container-wrapper"},X=N({__name:"MapContainer",props:{autoLocate:{type:Boolean},initialCenter:{},initialZoom:{},startPoint:{},endPoint:{},transportMode:{},startName:{},endName:{},markers:{}},emits:["map-ready","poi-click","route-completed","marker-click"],setup(x,{expose:P,emit:h}){const d=x,I=h,t=R(null);let n=null,u=null,M=null,b=null,y=null,e=null,p=null,a=null,r=null,i=[],o=null;const g=async()=>{if(t.value)try{window._AMapSecurityConfig={securityJsCode:"a3ae5b960f3ed908393672ac36fc7bf1"},o=await K.load({key:"d7dd3eae862ecc57ed11d6f603358601",version:"2.0",plugins:["AMap.ToolBar","AMap.Scale","AMap.Geolocation","AMap.Geocoder","AMap.Driving","AMap.Walking","AMap.Riding"],AMapUI:{version:"1.1",plugins:[]}}),n=new o.Map(t.value,{zoom:d.initialZoom||11,center:d.startPoint||d.initialCenter||[118.06702,24.444695],viewMode:"3D",pitch:30}),n.addControl(new o.ToolBar),n.addControl(new o.Scale),u=new o.Geocoder({city:"010",radius:1e3}),e=new o.InfoWindow({isCustom:!0,offset:new o.Pixel(15,-50)}),L(),I("map-ready",n),C(),d.autoLocate&&B(),d.startPoint&&d.endPoint&&S(d.startPoint,d.endPoint,d.transportMode||"driving"),d.markers&&d.markers.length>0&&c(d.markers)}catch(s){console.error("地图初始化失败:",s)}},c=s=>{n&&(w(),s.forEach((l,A)=>{const m=new o.Marker({position:new o.LngLat(l.lng,l.lat),title:l.name,icon:new o.Icon({size:new o.Size(25,34),image:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png"}),extData:l});m.on("click",k=>{I("marker-click",l,k)}),n.add(m),i.push(m)}),i.length>0&&n.setFitView(i,!0))},w=()=>{!n||i.length===0||(n.remove(i),i=[])};j(()=>d.markers,s=>{s&&s.length>0&&n?c(s):n&&w()},{deep:!0});const L=()=>{M=new o.Driving({map:n,panel:null,showDir:!0,hideMarkers:!0,routeList:!1}),b=new o.Walking({map:n,panel:null,showDir:!0,hideMarkers:!0,routeList:!1}),y=new o.Riding({map:n,panel:null,showDir:!0,hideMarkers:!0,routeList:!1})},C=()=>{!n||!u||n.on("click",s=>{const l=s.lnglat;u.getAddress(l,(A,m)=>{if(A==="complete"&&m.regeocode){const k={lnglat:l,longitude:l.getLng(),latitude:l.getLat(),address:m.regeocode.formattedAddress,addressComponent:m.regeocode.addressComponent,pois:m.regeocode.pois||[],businessAreas:m.regeocode.businessAreas||[]};console.log("点击位置信息:",k),I("poi-click",k)}else console.error("根据经纬度查询地址失败:",m)})})},B=()=>{const s=new o.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new o.Pixel(10,20),zoomToAccuracy:!0});n.addControl(s),s.getCurrentPosition(),s.on("complete",l=>{console.log("定位成功:",l)}),s.on("error",l=>{console.error("定位失败:",l)})},E=(s,l)=>{D(),a=new o.Marker({position:new o.LngLat(s[0],s[1]),icon:new o.Icon({size:new o.Size(25,34),image:"//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png",imageOffset:new o.Pixel(-9,-3),imageSize:new o.Size(135,40)}),title:d.startName||"起点",offset:new o.Pixel(-18,-36)}),r=new o.Marker({position:new o.LngLat(l[0],l[1]),icon:new o.Icon({size:new o.Size(25,34),image:"//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png",imageOffset:new o.Pixel(-95,-3),imageSize:new o.Size(135,40)}),title:d.endName||"终点",offset:new o.Pixel(-18,-36)}),n.add([a,r])},D=()=>{a&&(n.remove(a),a=null),r&&(n.remove(r),r=null)},O=()=>{p&&(n.removeLayer(p),p=null)},S=(s,l,A="driving")=>{if(!n)return;const m=new o.LngLat(s[0],s[1]),k=new o.LngLat(l[0],l[1]);E(s,l),O();let _;switch(A){case"walking":_=b;break;case"riding":_=y;break;case"driving":default:_=M;break}_.search(m,k,(z,f)=>{if(console.log(`路线规划(${A})结果状态:`,z),console.log("路线规划返回的原始数据:",f),z==="complete"&&f){let U=null,v=null;f.route&&f.route.paths&&f.route.paths.length>0?(U=f.route,v=f.route.paths[0]):f.paths&&f.paths.length>0?(U={paths:f.paths},v=f.paths[0]):f.path&&(v={path:f.path}),v?(console.log("路线规划成功，路径数据:",v),p=v.path,I("route-completed",{status:"success",mode:A,route:U||f,distance:v.distance,duration:v.duration,steps:v.steps}),n.setFitView([a,r],!0)):(console.error("路线规划返回数据不完整，无法获取路径信息:",f),I("route-completed",{status:"error",mode:A,message:"路线规划返回数据结构异常，无法提取路径信息"}))}else{const U=f&&f.info?f.info:"路线规划失败或返回数据异常";console.error("路线规划失败:",U,f),I("route-completed",{status:"error",mode:A,message:U})}})};return P({showInfoWindow:(s,l)=>{e.setContent(l),e.open(n,s)},closeInfoWindow:()=>{e&&e.close()},getMapInstance:()=>n}),j(()=>[d.startPoint,d.endPoint,d.transportMode],([s,l,A])=>{s&&l&&n&&S(s,l,A||"driving")},{deep:!0}),F(()=>{g()}),T(()=>{n&&(n.destroy(),n=null),u=null,M=null,b=null,y=null,a=null,r=null,i=[],p=null}),(s,l)=>(V(),Z("div",Q,[q("div",{ref_key:"mapContainer",ref:t,class:"map-container"},null,512)]))}});const oe=H(X,[["__scopeId","data-v-2db81fe2"]]);export{oe as M};
