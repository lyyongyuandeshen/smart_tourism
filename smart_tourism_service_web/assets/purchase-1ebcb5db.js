import{d as z,bN as J,E as Z,r as _,c as A,l as K,o as i,b as p,g as t,e as c,a as l,F as h,q as k,w as f,v as n,B as L,t as D,M as $,O as C,R as G,x as H,K as F,aO as Q,D as W}from"./index-1b86b595.js";import{p as X,t as Y,M,f as ee}from"./index-c987cbfd.js";import{_ as te}from"./index.vue_vue_type_script_setup_true_lang-fa150018.js";import{N as se}from"./Progress-fcce5034.js";import{N as ae}from"./DatePicker-7d6da68d.js";const le={class:"min-h-screen bg-[#f5f5f5]"},ne={class:"max-w-[70%] mx-auto p-[1.5rem]"},oe={class:"bg-white rounded-[0.5rem] p-[1rem_1.5rem] mb-[1.25rem]"},re={class:"flex gap-[12px] flex-wrap items-center"},ce=["onClick"],ie={class:"bg-white rounded-[0.5rem] p-[1rem_1.5rem] mb-[1.25rem]"},ue={class:"flex justify-between items-center mb-[1.5rem]"},de={class:"flex justify-between items-center mb-[0.5rem]"},me={class:"flex gap-[16px]"},pe={class:"flex-1"},ve={class:"flex-1"},_e={class:"bg-white rounded-[0.5rem] p-[1rem_1.5rem] mb-[1.25rem]"},fe={class:"flex flex-col gap-[12px]"},xe={class:"flex-1 flex flex-col justify-between h-full"},he={class:"w-[42px]"},ye={class:"text-[13px] text-[#4E5969]"},ge={class:"text-[13px] text-[#4E5969]"},be={class:"flex items-center gap-[0.875rem]"},ke={class:"text-[1.5rem] text-[#ff7d00]"},we={class:"bg-white rounded-[0.5rem] p-[1rem_1.5rem] mb-[1.25rem]"},Ce={class:"flex flex-col gap-[8px]"},Ne={class:"price-name"},qe={class:"flex items-center gap-4"},De={class:"flex items-center border rounded-md"},$e=["onClick"],Fe={class:"px-3 py-1 min-w-[2rem] text-center"},Me=["onClick"],Re={class:"text-[#1D2129]"},Te={class:"flex justify-between items-center"},je={class:"text-[1.5rem] text-[#ff7d00]"},Be={class:"flex items-center gap-[12px]"},Ee={class:"flex justify-end gap-2"},Ie=z({__name:"purchase",setup(Pe){const R=a=>{o.value[a]&&(o.value[a].count+=1)},T=a=>{o.value[a]&&o.value[a].count>1?o.value[a].count-=1:o.value[a]&&o.value[a].isCombo&&o.value.splice(a,1)},u=J(),j=Z(),y=_(!1),v=u.currentRoute.value.query.scenicName||"";let w=u.currentRoute.value.query.date||"";const g=_([]),B=a=>{g.value.forEach(s=>{s.active=!1}),a.active=!0},E=[{id:1,name:"景区1",desc:"景区1活动",price:200,sales:"100+",tag:"限时推荐"},{id:2,name:"景区2",desc:"景区2活动",price:120,sales:"100+",tag:"限时推荐"}],o=_([]),d=_([{id:1,name:"",phone:""},{id:2,name:"",phone:""}]),N=A(()=>o.value.reduce((a,s)=>a+s.price*s.count,0)),I=()=>{const a=d.value.length+1;d.value.push({id:a,name:"",phone:""})},P=a=>{d.value.length>1&&(d.value=d.value.filter(s=>s.id!==a))},U=()=>{var r;y.value=!0;const a=g.value.find(m=>m.active),s=(r=o.value.find(m=>m.name===v))==null?void 0:r.count,e={user_id:"550e8400e29b41d4a716446655440002",scenic_id:"FJ_FZ_001",scenic_name:v,order_title:v,tourists:d.value,ticket_date:w,start_time:a.startTime,end_time:a.endTime,ticket_price:Number(u.currentRoute.value.query.price||0),ticket_quantity:s,sales_channel:1,channel_name:"官网"};X(e).then(m=>{y.value=!1,u.push({name:"TicketPay",query:{totalPrice:N.value,name:v}})}).catch(m=>{y.value=!1,j.error(m.message)})},b=_(!1),x=_(null),O=()=>{if(b.value=!0,u.currentRoute.value.query.date){const a=u.currentRoute.value.query.date;if(a){const s=new Date(a).getTime();x.value=s}}},S=()=>{x.value&&(b.value=!1,w=ee(x.value),q())},V=a=>{o.value.push({name:a.name,price:a.price,count:1,isCombo:!0})},q=async()=>{const a=u.currentRoute.value.query.time||"",s=await Y("FJ_FZ_001",{reservation_date:w});g.value=(s==null?void 0:s.map(e=>({id:e.id,name:`${e.start_time}-${e.end_time}余票`,available:e.remaining_quota,total:e.total_quota,active:`${e.start_time}-${e.end_time}`===a,startTime:e.start_time,endTime:e.end_time})))||[]};return K(async()=>{q(),o.value.push({name:v,price:Number(u.currentRoute.value.query.price||0),count:1})}),(a,s)=>(i(),p(h,null,[t("div",le,[c(l(te),{spotName:l(v),isImg:!1},null,8,["spotName"]),t("div",ne,[t("div",oe,[s[3]||(s[3]=t("h3",{class:"text-[1.25rem] mb-[1.5rem] text-[#1d2129]"},"日期选择",-1)),t("div",re,[(i(!0),p(h,null,k(g.value,e=>(i(),p("div",{key:e.id,class:"flex-1 min-w-[124px] p-[0.75rem] rounded-[0.25rem] cursor-pointer bg-[#f7f8fa] text-center",onClick:r=>B(e)},[t("span",{class:L(["text-sm",{"text-[#235fc8]":e.active}])},n(e.name),3),c(l(se),{type:"line",percentage:Number(e.available/e.total*100),class:"mt-4"},{default:f(()=>[D(n(e.available)+"/"+n(e.total),1)]),_:2},1032,["percentage"])],8,ce))),128)),t("div",{class:"px-[31px] py-[12px] text-[0.875rem] text-[#165dff] cursor-pointer",onClick:O},[...s[2]||(s[2]=[t("span",null,"更多日期",-1)])])])]),t("div",ie,[t("div",ue,[s[4]||(s[4]=t("h3",{class:"text-[1.25rem] text-[#1d2129]"},"游客信息",-1)),c(l(C),{quaternary:"",circle:"",size:"small",onClick:I},{default:f(()=>[c(l($),{icon:"ri:add-line"})]),_:1})]),(i(!0),p(h,null,k(d.value,e=>(i(),p("div",{class:"mb-[16px] pb-[16px]",key:e.id},[t("div",de,[t("span",null,"游客"+n(e.id),1),d.value.length>1?(i(),G(l(C),{key:0,quaternary:"",size:"small",onClick:r=>P(e.id)},{default:f(()=>[c(l($),{icon:"ri:close-circle-line"})]),_:1},8,["onClick"])):H("",!0)]),t("div",me,[t("div",pe,[s[5]||(s[5]=t("label",{class:"block text-[14px] text-[#666] mb-1"},"姓名",-1)),c(l(F),{value:e.name,"onUpdate:value":r=>e.name=r,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),t("div",ve,[s[6]||(s[6]=t("label",{class:"block text-[14px] text-[#666] mb-1"},"手机号",-1)),c(l(F),{value:e.phone,"onUpdate:value":r=>e.phone=r,placeholder:"请输入"},null,8,["value","onUpdate:value"])])])]))),128))]),t("div",_e,[s[7]||(s[7]=t("h3",{class:"text-[1.25rem] mb-[1.5rem] text-[#1d2129]"},"组合推荐",-1)),t("div",fe,[(i(),p(h,null,k(E,e=>t("div",{key:e.id,class:"flex justify-between items-center p-[0.875rem] rounded-[0.5rem] bg-[#F7F8FA] h-[124px] hover:bg-[#f0f0f0]"},[t("div",xe,[t("div",he,n(e.name),1),t("div",ye,n(e.desc),1),t("div",ge," 已售"+n(e.sales)+" | "+n(e.tag),1)]),t("div",be,[t("span",ke,"¥"+n(e.price.toFixed(2)),1),c(l(M),{type:"primary",text:"购票",onClick:r=>V(e)},null,8,["onClick"])])])),64))])]),t("div",we,[s[8]||(s[8]=t("h3",{class:"text-[1.25rem] flex items-center mb-[1.5rem] text-[#1d2129]"}," 价格详情 ",-1)),t("div",Ce,[(i(!0),p(h,null,k(o.value,(e,r)=>(i(),p("div",{key:r,class:"flex justify-between mb-[1rem] text-[#4E5969]"},[t("span",Ne,n(e.name),1),t("div",qe,[t("div",De,[t("button",{onClick:m=>T(r),class:"px-2 py-1 text-gray-500 hover:bg-gray-100"}," - ",8,$e),t("span",Fe,n(e.count),1),t("button",{onClick:m=>R(r),class:"px-2 py-1 text-gray-500 hover:bg-gray-100"}," + ",8,Me)]),t("span",Re,"¥"+n(e.price)+"×"+n(e.count),1)])]))),128)),t("div",Te,[t("span",je,"¥"+n(N.value.toFixed(2)),1),t("div",Be,[c(l(M),{type:"primary",loading:y.value,onClick:U,text:"去支付"},null,8,["loading"])])])])])])]),c(l(Q),{show:b.value,"onUpdate:show":s[1]||(s[1]=e=>b.value=e),title:"选择日期",preset:"card",style:{width:"300px"}},{footer:f(()=>[t("div",Ee,[c(l(C),{type:"primary",bordered:!1,onClick:S},{default:f(()=>[...s[9]||(s[9]=[D("确认",-1)])]),_:1})])]),default:f(()=>[c(l(ae),{value:x.value,"onUpdate:value":s[0]||(s[0]=e=>x.value=e),type:"date",format:"yyyy-MM-dd",class:"w-full"},null,8,["value"])]),_:1},8,["show"])],64))}});const Je=W(Ie,[["__scopeId","data-v-110680f1"]]);export{Je as default};
