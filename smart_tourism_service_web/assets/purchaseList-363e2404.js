import{d as E,bN as $,r as p,c as q,l as B,o as n,b as l,e as d,a as r,g as s,F as y,q as g,x as v,aw as T,M as I,B as b,v as c,w as M,t as L,D as P}from"./index-1b86b595.js";import{f as R,t as V,M as A}from"./index-c987cbfd.js";import{_ as j}from"./index.vue_vue_type_script_setup_true_lang-fa150018.js";import{N as z}from"./Progress-fcce5034.js";import{N as J}from"./DatePicker-7d6da68d.js";const O={class:"purchase-container"},S={class:"p-6"},Z={class:"flex items-center gap-4 mb-4"},G={class:"mb-4 overflow-x-auto bg-white p-2 rounded-[0.375rem]"},H={key:0,class:"flex"},K=["onClick"],Q={key:0,class:"text-[#FF7D00] bg-[#FFF7E8] text-xs rounded-sm px-2 absolute top-0 right-0"},W={key:0,class:"h-full border-r border-[#E5E6EB] mx-2"},X={key:1,class:"text-[#86909C] text-center"},Y={key:0,class:"ticket-list space-y-4"},ee={class:"ticket-info flex-1"},te={class:"flex gap-[0.875rem]"},se={class:"flex-1 flex flex-col justify-between"},ae={class:"text-[#1D2129]"},ne={class:"text-[13px] text-[#4E5969]"},le={class:"flex items-center text-[13px] text-[#4E5969] gap-4"},ie={key:0},oe={class:"flex gap-[0.875rem] items-center"},re={class:"text-[1.5rem] text-[#FF7D00] font-medium"},ce=E({__name:"purchaseList",setup(ue){const _=$(),u=p(null),m=p(null),C=_.currentRoute.value.query.name||"",F=_.currentRoute.value.query.ticketId||"",k=[{label:"全部票型",value:"all"},{label:"成人票",value:"adult"},{label:"学生票",value:"student"},{label:"儿童票",value:"child"},{label:"老人票",value:"senior"},{label:"团体票",value:"group"}],o=p([]),h=p([{id:1,name:"学生票+交通套票",type:"student",notice:"未使用、未过期前可在原购票通道自助退票；特价票、活动票、联票首次核销后概不退换",salesCount:"100+",instantUse:!0,price:220},{id:2,name:"成人票+交通套票",type:"adult",notice:"不支持改签",salesCount:"100+",instantUse:!0,price:280},{id:3,name:"儿童票+交通套票",type:"child",notice:"普遍免票：6 周岁(含)或 1.2 米(含)以下儿童、70 岁以上老人、现役军人、残疾人等，需凭有效证件在窗口或检票口核验",salesCount:"50+",instantUse:!0,price:160},{id:4,name:"学生票",type:"student",notice:"多数溶洞、山岳型景区禁止携带宠物（导盲犬除外）",salesCount:"100+",instantUse:!0,price:120},{id:5,name:"成人票",type:"adult",notice:"未使用、未过期前可在原购票通道自助退票；特价票、活动票、联票首次核销后概不退换",salesCount:"80+",instantUse:!0,price:180},{id:5,name:"老人票",type:"senior",notice:"未使用、未过期前可在原购票通道自助退票；特价票、活动票、联票首次核销后概不退换",salesCount:"30+",instantUse:!0,price:100},{id:7,name:"团体票（10人及以上）",type:"group",notice:"需提前1天预约，凭单位证明或团体预约码入园",salesCount:"20+",instantUse:!1,price:160},{id:8,name:"成人票+特色体验",type:"adult",notice:"含特色文化体验活动，全程约120分钟",salesCount:"60+",instantUse:!0,price:320}]),N=q(()=>!u.value||u.value==="all"?h.value:h.value.filter(i=>i.type===u.value)),w=i=>{const t=o.value.find(e=>e.active);_.push({name:"TicketPurchase",query:{scenicName:i.name,scenicId:F,time:t==null?void 0:t.time,date:t==null?void 0:t.reservationDate,price:i.price}})},D=()=>{u.value=null,m.value=null,f()},f=async()=>{const i=m.value?R(m.value):null,t=await V("FJ_FZ_001",{reservation_date:i});let e=!1;o.value=(t==null?void 0:t.map(a=>{const x=!e&&a.remaining_quota>0;return x&&(e=!0),{id:a.id,name:`${a.start_time}-${a.end_time}余票`,available:a.remaining_quota,total:a.total_quota,recommended:!1,time:`${a.start_time}-${a.end_time}`,reservationDate:a.reservation_date,active:x}}))||[]},U=i=>{o.value.forEach(t=>{t.active=!1}),i.active=!0};return B(async()=>{f()}),(i,t)=>(n(),l("div",O,[d(r(j),{spotName:r(C),isImg:""},null,8,["spotName"]),s("div",S,[s("div",Z,[d(r(T),{value:u.value,"onUpdate:value":t[0]||(t[0]=e=>u.value=e),options:k,placeholder:"票型",class:"!w-[13.75rem]"},null,8,["value"]),d(r(J),{value:m.value,"onUpdate:value":[t[1]||(t[1]=e=>m.value=e),f],type:"date",format:"yyyy-MM-dd",class:"!w-[15.25rem]"},null,8,["value"]),s("div",{onClick:D,class:"bg-white p-[0.375rem] rounded-lg cursor-pointer hover:bg-[#F2F3F5] transition-colors"},[d(r(I),{icon:"ri:refresh-line",class:"w-[1.125rem] h-[1.125rem]"})])]),s("div",G,[o.value.length?(n(),l("div",H,[(n(!0),l(y,null,g(o.value,(e,a)=>(n(),l("div",{class:"flex",key:e.id},[s("div",{class:b(["time-slot flex flex-col items-center w-[224px] relative cursor-pointer",{"bg-[#F7F8FA]":e.active}]),onClick:x=>U(e)},[s("div",{class:b(["text-sm",{"text-[#235FC8]":e.recommended}])},c(e.name),3),d(r(z),{type:"line",percentage:Number(e.available/e.total*100),class:"mt-1"},{default:M(()=>[L(c(e.available)+"/"+c(e.total),1)]),_:2},1032,["percentage"]),e.recommended?(n(),l("div",Q," 推荐购买 ")):v("",!0)],10,K),a<o.value.length-1?(n(),l("div",W)):v("",!0)]))),128))])):(n(),l("div",X,"暂无余票"))]),o.value.length?(n(),l("div",Y,[(n(!0),l(y,null,g(N.value,e=>(n(),l("div",{key:e.id,class:"ticket-item bg-white rounded-lg p-[0.875rem] flex items-center"},[s("div",ee,[s("div",te,[t[2]||(t[2]=s("div",{class:"w-24 h-24 bg-[#F2F3F5] rounded-lg flex items-center justify-center text-sm text-[#86909C]"}," 1:1 ",-1)),s("div",se,[s("h3",ae,"票名："+c(e.name),1),s("p",ne," 购买须知："+c(e.notice),1),s("div",le,[s("span",null,"已售"+c(e.salesCount),1),e.instantUse?(n(),l("span",ie,"随买随用")):v("",!0)])])])]),s("div",oe,[s("div",re," ¥"+c(e.price.toFixed(2)),1),d(r(A),{text:"购票",type:"primary",onClick:a=>w(e)},null,8,["onClick"])])]))),128))])):v("",!0)])]))}});const fe=P(ce,[["__scopeId","data-v-ec0db297"]]);export{fe as default};
